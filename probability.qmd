# Probability {#sec-probability}

```{r}
#| include: false

source("_common.R")
```

```{r start-collecting-terms}
#| include: false
terms_chp_3 <- c("probability")

```


::: {.chapterintro data-latex=""}
Suppose a couple planning to have a child learns from genetic testing that they are both carriers of cystic fibrosis; they are unaffected but each have one copy of a gene containing mutations that confer cystic fibrosis. What is the likelihood that they have a child with cystic fibrosis?

If someone takes a rapid antigen self-test for COVID-19 and obtains a positive test result, how likely is it that they actually have the infection?

The rules of probability can be used to answer both questions. In some cases, probabilities can be calculated directly without formulas, while in others the rules and formulas for probability provide tools for breaking down complex problems into a series of simpler steps.
:::


## Two examples: genetic screening for cystic fibrosis and rapid antigen testing for COVID-19 {#sec-two-examples}

### Screening for cystic fibrosis {#sec-screening-cf}

Cystic fibrosis (CF) is a life-threatening genetic disorder caused by mutations in the *CFTR* gene located on chromosome 7. Defective copies of *CFTR* can result in a reduced quantity and function of the CFTR protein, leading to the buildup of thick mucus in the lungs and pancreas.^[The CFTR protein is responsible for transporting sodium and chloride ions across cell membranes.] CF is an autosomal recessive disorder; an individual only develops CF if they have inherited two affected copies of *CFTR*. Individuals with one normal (wild-type) copy and one defective (mutated) copy are known as *carriers*; they do not develop CF, but may pass the disease-causing mutation onto their offspring.

Suppose that both members of a couple are CF carriers. What is the probability that a child of this couple will be affected by CF? Assume that a parent has an equal chance of passing either gene copy to a child.

In @fig-cfInheritance, chromosomes with a mutated copy of *CFTR* are marked with a red bar and notated with a $-$. Each carrier has one mutated copy and one wild-type copy; thus, their genotype is $+/-$. The four possible genotypes for a child are shown in the lower right. The child is affected only if they have two mutated copies of *CFTR*. Since inheriting the mutated copy and wild-type copy occurs with equal chance from each parent, each of the four outcomes occurs with equal likelihood. The probability that the child will have cystic fibrosis is 1/4.

```{r cf-inheritance}
#| label: fig-cfInheritance
#| out-width: 80%
#| fig-cap: |
#|   Pattern of CF inheritance for a child of two unaffected carriers.  Paternal chromosomes are depicted in green and maternal in blue. Chromosomes with CF mutations are denoted with a red horizontal band. There is a 1/4 chance of an unaffected child, 1/2 chance of a carrier, and 1/4 chance of a child with cystic fibrosis. 
#| fig-alt: |
#|   The pattern of cystic fibrosis inheritance for a child of two unaffected carriers. The figure uses colored chromosomes to show genetic combinations: green for paternal and blue for maternal. Red bands are used to mark the affected chromosomes. There are four possible outcomes. With a 1-in-4 chance, a child will receive a copy of an affected chromosome from each parent and have cystic fibrosis. 
#| fig-pos: H
knitr::include_graphics("images/cfInheritance.png")
```


```{r}
# ppv for covid RAT
# also used and repeated later
# 

sens_rat <- 0.80
spec_rat <- 0.98
prev_covid_05 <- 0.05

ppv_rat_05 <- round((sens_rat * prev_covid_05)/(sens_rat * prev_covid_05 + (1 - spec_rat) * (1 - prev_covid_05)), 2)
npv_rat_05 <- round(spec_rat * (1 - prev_covid_05) /(spec_rat * 1 - prev_covid_05 + (1 - sens_rat) * prev_covid_05), 2)

```

### Rapid self-tests for COVID-19 {#sec-rat-covid}

Since the COVID-19 pandemic, rapid antigen tests (RAT) have been widely used as self-tests, allowing individuals to check for the virus on their own. These tests remain available at pharmacies, neighborhood health centers, libraries, and other distribution sites. They are convenient and either low-cost or free. But how reliable are the tests? More specifically, what is the chance that a positive result truly indicates infection, or that a negative result correctly confirms absence of infection?

Studies have shown that when 100 people with COVID-19 are tested using a nasal swab RAT, about 80 will test positive [@khalid2022performance]. The same studies have shown that when 100 people without the infection are tested, about 98 will test negative.  In the language of probability, the chance of a positive test is `r sens_rat` when the virus is present,  while the chance of a negative test in the absence of the virus is `r spec_rat`.  But an individual who has just tested is most interested in the *reverse* probabilities: the chance of having COVID-19 when the test is positive or the chance of not having the infection when the test is negative. In other words, out of 100 people who test positive, how many actually have COVID-19? The tools in Sections [-@sec-conditional-probability] and [-@sec-bayes-rule] will show that even though the rapid self-tests are correct 80% of the time when the virus is present, under some assumptions a positive test might only be correct `r (ppv_rat_05) * 100`% of the time. 

## The rules of probability {#sec-probability-rules}

In both examples in @sec-two-examples, probability is used to quantify uncertainty about the **outcome** of a random phenomenon. However, these two examples differ in important ways.  In the first example, the set $S$ of all outcomes, called the **sample space**, \index{sample space} is a simple collection of 4 equally likely outcomes. The probability of a particular set of outcomes can be calculated by counting the relevant outcomes and dividing by the total number of outcomes in the sample space. The second example is more complex; it poses questions about the probability of an outcome under the condition that it has been preceded by another outcome (that is, the likelihood of infection when a self-test is known to be positive) and cannot easily be solved by the direct methods of the first example. More difficult problems need a general definition of probability and a set of rules to guide calculations.

::: {.important data-latex=""}
**Randomness and probability.**

A phenomenon is called random if the outcome of a single occurrence is uncertain, but the relative frequencies of different outcomes settle into stable proportions when many outcomes are observed.

The probability $p$ of an outcome for a random phenomenon is the long-run proportion of times the outcome occurs if the phenomenon is repeated many times under the same conditions.^[Another definition of probability is based on the subjective belief that an event will happen, that that approach is not covered in this text.]

:::

This is formalized in the Law of Large Numbers: when a random experiment is repeated many times, the observed proportion of an outcome converges to its true probability. For example, the probability of rolling a 1 on a fair six-sided die is 1/6. This does not mean that if the die is rolled 6 times, exactly one 1 will occur. However, if the die is rolled many times, the proportion of 1's will get closer to 1/6.

::: {.important data-latex=""}
**Sample spaces and events.**

The **sample space** $S$ of a random phenomenon is the set of all possible outcomes.  An **event** \index{event} $A$ is an outcome or a collection of outcomes in a random phenomenon.  It is a subset of the sample space, $S$.

:::

The  notation of set theory is used to describe events.  

* The complement $A^c$ of an event $A$ consists of all the outcomes in $S$ not in $A$.  

* Two events $A$ and $B$ are **disjoint** \index{disjoint events} or **mutually exclusive** \index{mutually exclusive}  if they have no outcomes in common.  

* The event $(A \text{ and } B)$ consists of the outcomes in $S$ that are members of both $A$ and $B$, sometimes described as members that satisfy both $A$ and $B$.  In some texts this is written $A \cap B$.

* The event $(A \text{ or } B)$ consists of the outcomes that are either in $A$ or $B$ or possibly both. This can also be written as $A \cup B$.    

* For conciseness, sentences such as "$B$ is the event that a child has CF" are written as $B$ = {child has CF}. 

```{r}
terms_chp_3 <- c(terms_chp_3, c("sample space",
                                "outcome",
                                "event",
                                "disjoint events",
                                "mutually exclusive events")
)
```


::: {.workedexample data-latex=""} 

Suppose $A$ = {a child of two adults who carry the CF gene is an unaffected carrier}.  Which members of the sample space belong to $A$?

------------------------------------------------------------------------

The event $A$ consists of the outcomes in the upper right and lower left of the boxes in @fig-cfInheritance showing the possible genotypes of a child.
:::


::: {.guidedpractice data-latex=""}

Suppose the random phenomenon of interest is rolling a single six-sided die.  Describe the sample space $S$, the event $A$ = {the outcome of the roll is an even number} and its complement $A^c$.
[^probability-1]
:::

[^probability-1]: $S$ = {1, 2, 3, 4, 5, 6}, $A$ = {2, 4, 6} and $A^c$ = {1, 3, 5}.  $A^c$ is the event of rolling an odd number.

::: {.guidedpractice}
When rolling a six-sided die, are the events $A$ = {the outcome is an even number} and $B$ = {the outcome is smaller than 4} disjoint? Describe the event ($A \text{ and } B$) and the event $(A \text{ or } B)$.
[^probability-2]
:::

[^probability-2]: No, the two events have the outcome 2 in common. $(A \text{ and } B)$ = {2} while $(A \text{ or } B)$ = {1, 2, 3, 4, 6}.

::: {.workedexample data-latex=""}

What is the sample space corresponding to the random process of rolling two six-sided dice and recording the value of the faces showing?

------------------------------------------------------------------------

There are 6 possible outcomes for the first die, and for each of those outcomes there are 6 possible outcomes for the second die, so the sample space consists of the 36 ordered pairs $(j,k)$, where $j$ and $k$ can be any of the integers between 1 and 6.
:::

::: {.guidedpractice data-latex=""}

Describe the event $A$ = {the sum of dice is 4} when rolling two dice.[^probability-101]
:::

[^probability-101]: $A$ = {$(1,3), (2,2), (3,1)$}.


```{r load-gss}
load("./data/gss_df.Rdata")
load("./data/gen_ss.Rdata")
```


The General Social Survey is conducted by the National Opinion Research Center (NORC) at the University of Chicago.  The survey collects data on American society by asking respondents demographic, behavioral, and attitudinal questions along with some topics of special interest. It has been conducted approximately every two years since 1972. @tbl-gss-age-health shows  `r nrow(gen_ss)` total responses to two selected variables from respondents participating in surveys conducted between 2018 and 2024, classified according to the age of the respondent and self-perception of their general health.^[The data in this and similar tables later in the text do not include missing values from non-response since methods for adjusting for missing values are beyond the scope of this text. Accordingly, the data in the table is not used to estimate population parameters.]  

```{r tbl-gss-age-health}
#| label: tbl-gss-age-health
#| tbl-cap:  "Counts of health rating and age group"
#| tbl-pos: H
gen_ss |> 
  select(age_group, 
         health_status) |> 
  count(age_group, health_status) |> 
  group_by(age_group) |> 
  pivot_wider(names_from = health_status, 
              values_from = n) |> 
  adorn_totals(where = c("row", "col"), name = "Sum") |> 
  kbl(linesep = "",
      booktabs = TRUE) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    latex_options = c("striped"),
    full_width = FALSE) |>
  add_header_above(c("Age " = 1, "Health rating" = 5)) |>
  column_spec(1, width = "4em") |>
  column_spec(2:6, width = "4em") |> 
  column_spec(6, bold = TRUE) |> 
  row_spec(5, bold = TRUE) 
  
```


```{r gss-age-health-elements, echo = FALSE}
df <- gen_ss

t <- table(df$age_group, df$health_status)
tbl_age_health <-  addmargins(t)
tbl_age_health_prop <- round(addmargins(prop.table(t)),3)


```



::: {.workedexample data-latex=""}

Suppose that a researcher plans to sample a case randomly from the `r nrow(gen_ss)` in this dataset to conduct an additional interview using contact information in a confidential file.  (a) What is the sample space for this process?  (b) Which outcomes belong to the event $A$ = {a respondent said they were older than 25}?  How many responses satisfy $A$? (c) Let $B$ = {health rating good}.  What is $B^c$? How many respondents satisfy $B^c$? (d) How many respondents satisfy the event $(A \text{ and } B)$? 

------------------------------------------------------------------------

(a)  The sample space consists of the `r nrow(gen_ss)`  cases in the dataset.

(b) The event $A$ consists of a response in one of the 3 older age groups, 26 to 45, 46 to 65, and 65+.  The total number of outcomes is the sum of the number of respondents listed in the **Sum** column for the  3 corresponding rows, or `r tbl_age_health[2,5] + tbl_age_health[3, 5] + tbl_age_health[4, 5]`.

(c) The event $B^c$ corresponds to all the outcomes in which respondents rated their health other than good, that is, the sum of the elements in the row labeled **Sum** excluding the second column.  Alternatively, it can be calculated as the total number of respondents minus the number of respondents who rated their health as good, or `r tbl_age_health[5, 5] - tbl_age_health[5, 2]`.

(d) The number of outcomes satisfying $(A \text{ and } B)$ is the sum of the counts in rows 2, 3 and 4 of column 2, or `r tbl_age_health[2,2] + tbl_age_health[3, 2] + tbl_age_health[4, 2]`.  
:::

::: {.guidedpractice data-latex=""}

For the events $A$ and $B$ defined above, describe the events $(A^c)$, $(A \text{ or } A^c)$, and $(A^c \text{ and } B)$.  How many outcomes are in each? [^probability-3]
:::

[^probability-3]: The event $(A^c)$ consists of all the respondents in the age group 18 to 25; there are `r tbl_age_health[1,5]` outcomes in this event.  The event $(A \text{ or } A^c)$ consists of all  `r nrow(gen_ss)` cases in the dataset. $(A^c \text{ and } B)$ consists of the `r  tbl_age_health[1,2]` respondents who are age 18 - 25 and rated their health as good.  


@tbl-gss-age-health-prop displays the data from @tbl-gss-age-health but with proportions replacing counts; the proportions in each cell give the fraction of the observations in the cell when the counts have been divided by the size of the dataset, `r nrow(gen_ss)`, and can be used to calculate probabilities.  For instance, the value 0.019 in the upper left cell is the proportion of individuals age 18 to 25 and reporting excellent health, or `r tbl_age_health[1,1]` / `r tbl_age_health[5,5]`. 

```{r tbl-gss-age-health-prop}
#| tbl-cap:  "Heath rating and age group, with counts replaced by proportions"
#| tbl-pos: H
#| label: tbl-gss-age-health-prop
gen_ss |> 
  select(age_group, 
         health_status) |> 
  count(age_group, health_status) |> 
  mutate(prop = n /sum(n)) |> 
  select(-n) |> 
  pivot_wider(names_from = health_status, 
              values_from = prop,
              values_fill = 0) |> 
  adorn_totals(where = c("row", "col"), name = "Sum") |> 
  kbl(linesep = "",
      booktabs = TRUE) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    latex_options = c("striped"),
    full_width = FALSE) |>
  add_header_above(c("Age " = 1, "Health rating" = 5)) |>
  column_spec(1, width = "4em") |>
  column_spec(2:5, width = "4em") |> 
  column_spec(6, bold = TRUE) |> 
  row_spec(5, bold = TRUE) 
  
```

**Venn diagrams** \index{Venn diagrams} are often used to visualize the relationship between events in a sample space. The Venn diagram in @fig-gss-older-health-venn shows the relationship between the events $A$ and $B$ in the above example. It has less information than the full table, but provides a visual display of the overlap between $A$ and $B$.  The total possible outcomes belonging to $A$ is the sum of the 5071 members of $A$ outside $B$ and the 5844 in the intersection of the two events.  The number of members in $B$ is calculated similarly.  The 417 outcomes outside the two circles represents the members of the sample space not in either event.  The percentages shown in the figure can be used to converted to proportions to calculate the probabilities of regions in the figure, so the probability of $A$ is 0.432 + 0.498 = 0.930. 

```{r, include = FALSE}
# trying out a helper function to add sample space box

library(ggvenn)
library(ggplot2)

# Helper to read x/y ranges across ggplot2 versions
.range_from_panel <- function(pp, axis = c("x", "y")) {
  axis <- match.arg(axis)
  # Older ggplot2 (e.g., 3.3.x)
  rng1 <- pp[[paste0(axis, ".range")]]
  if (!is.null(rng1)) return(rng1)
  # Newer ggplot2 (e.g., 3.4+)
  rng2 <- try(pp[[axis]]$range$range, silent = TRUE)
  if (!inherits(rng2, "try-error") && !is.null(rng2)) return(rng2)
  # Fallback
  rng3 <- try(pp[[axis]]$range, silent = TRUE)
  if (!inherits(rng3, "try-error") && !is.null(rng3)) return(rng3)
  stop("Could not determine ", axis, " range from panel_params.")
}

add_sample_space <- function(p, expand = 0.05, color = "black", linewidth = 1) {
  gb <- ggplot_build(p)
  pp <- gb$layout$panel_params[[1]]

  xr <- .range_from_panel(pp, "x")
  yr <- .range_from_panel(pp, "y")

  xpad <- diff(range(xr)) * expand
  ypad <- diff(range(yr)) * expand

  p + annotate(
    "rect",
    xmin = xr[1] - xpad, xmax = xr[2] + xpad,
    ymin = yr[1] - ypad, ymax = yr[2] + ypad,
    fill = NA, color = color, linewidth = linewidth
  )
}

```


```{r older-health-venn}
#| label: fig-gss-older-health-venn
#| out-width: 70%
#| fig-cap: | 
#|     Venn diagram showing the overlap between the events {older than age 25} and {health rating good}.  
`Older than 25 (A)` <- (gen_ss$age_group != "18 to 25") 
`Health rating good (B)` <- (gen_ss$health_status == "good")
d <- data_frame(`Older than 25 (A)`, `Health rating good (B)`)

library(ggvenn)
p <- ggvenn(d, 
            fill_color = c(IMSCOL["blue", "full"], IMSCOL["red", "full"]),
            set_name_size = 4,
            auto_scale = FALSE)

add_sample_space(p) 
```

::: {.workedexample data-latex=""}

Describe in words the 417 outcomes represented by the white space outside the circles in @fig-gss-older-health-venn.

------------------------------------------------------------------------

The cases represented by the white space in the figure are those who are both 25 or younger and rated their health as other than good.

:::

Probabilities calculated from tables and Venn diagrams such have the following properties:


::: {.important data-latex=""}
**The properties of probability.**

**Probability of the sample space S:** If $S$ is the sample space of a random phenomenon, $P(S) = 1.$

**Boundedness:** The probability $P(A)$ of any event satisfies $0 \leq P(A) \leq 1.$

**Addition rule for disjoint events:**  If $A$ and $B$ are disjoint events,
$$
P(A \text{ or } B) = P(A) + P(B).
$$
If $A_1, A_2, \ldots A_k$ are a collection of $k$ disjoint events,
$$
P(A_1 \text { or } A_2 \ldots \text{ or } A_k) = P(A_1) + P(A_2) + \dots + P(A_k).
$$
**Complement rule:**  For any event $A$
$$
P(A^c) = 1 - P(A).
$$
:::

If no outcomes satisfy an event $A$, it cannot occur and $P(A)$ = 0. As a consequence, if $A$ and $B$ are disjoint events, $P(A \text{ and } B)$ = 0.

```{r}
terms_chp_3 <- c(terms_chp_3, c("Venn diagram",
                                "properties of probability",
                                "addition rule for disjoint events",
                                "complement rule")
)               
```


@tbl-gss-age-health-prop illustrates the first two rules of probability: the sum of all the probabilities is 1, and the values are between 0 and 1.  


::: {.workedexample data-latex=""}

Using the probabilities in @tbl-gss-age-health-prop and the rules of probability, find (a) the probability that someone chosen from this cohort rated their health as good, and (b) the probability that they rated their health as other than good.

------------------------------------------------------------------------

(a) The probability of being in good health is the sum of the probabilities in the second column, which is 0.532 as shown in the last row.  

    More formally, summing the column is an application of the addition rule for disjoint events.  Let $D_1$ = {health rated good and age between 18 and 25}, $D_2$ = {health rated good and age between 26 and 45},  $D_3$ = {health rated good and age 56 tp 65} and $D_4$ = {health rated good and age 66+}. Then the event $B$ = {health rated good} is a combination of disjoint events:
$$
B = (D_1 \text{ or } D_2 \text{ or } D_3 \text{ or } D_4),
$$
and 
$$
P(B) = P(D_1) + P(D_2) + P(D_3) + P(D_4). 
$${#eq-prob-good-health}

    When probabilities are calculated by summing rows or columns in a table, it is generally not necessary to write out the algebra in @eq-prob-good-health since the application of the addition rule is clear.

(b) If $H$ = {other than good health}, then $H = B^c$, so 
$$
P(H) = 1 - P(B) = 1 - 0.532 =0.477.
$$
A little less than 50% of this cohort rated their health as other than good.

    As always, it pays to be careful with the language used in a problem statement. While a phrase such as "not good" might only be interpreted as only referring to fair or poor, saying "other than good" more explicitly specifies that excellent, fair, and poor all belong to $H$.

:::

The solution to (a) used implicitly another probability rule, the rule of total probability, by breaking the event $B$ into disjoint chunks.  Here is a formal statement of the rule:

::: {.important data-latex=""}

**The rule of total probability.**

Suppose $A$ and $B$ are events in a sample space.  Then
$$ 
P(B) = P(B \text{ and } A) + P(B \text{ and } A^c).
$${#eq-total-probability}
More generally, let $E_1, E_2, \ldots, E_k$ be $k$ disjoint events that cover the sample space, so $(E_1 \text{ or } E_2 \cdots \text{ or } E_k) = S$. Then 
$$
P(B) = P(B \text{ and } E_1) + P(B \text{ and } E_2) + \cdots  + P(B \text{ and } E_k).
$${#eq-general-total-probability}

:::



```{r}
#| label: fig-lotp-general-venn
#| out-width: 65%
#| fig-cap: | 
#|     Diagram illustrating how to solve for the probability of an event $B$ by breaking the event into 
#|     disjoint events according to another three events $E_1, E_2$ and $E_3$. 
#| fig-alt: |
#|      A large rectangle represents the sample space S, which is divided vertically into three disjoint events, $E_1$, $E_2$, and $E_3$. An oval labeled B overlaps all three regions, representing event B. The overlapping shaded regions inside the oval represent the three possible intersections of B with the three partitions of E. The area of B can be found by summing the area inside the oval that is divided by the vertical lines.  
#|     
#| 


library(grid)
library(ggforce)

# --- canvas & partition ---
xlim <- c(0, 10)
ylim <- c(0, 6)
cuts <- c(3, 7)

# diagonal hatch lines over the sample space
step <- 0.35
t <- seq(-ylim[2], xlim[2], by = step)
hatch <- data.frame(
  x    = t,
  xend = t + ylim[2],
  y    = 0,
  yend = ylim[2]
)

# ellipse (event B)
B <- data.frame(x0 = 5.0, y0 = 3.0, a = 4.0, b = 2.4, angle = 0)

ggplot() +
  # sample space border
  geom_rect(aes(xmin = xlim[1], xmax = xlim[2], ymin = ylim[1], ymax = ylim[2]),
            fill = NA, color = "black", linewidth = 1) +
  # hatch
  geom_segment(data = hatch,
               aes(x = x, xend = xend, y = y, yend = yend),
               color = "#5DADE2", alpha = 0.25, linewidth = 0.6) +
  # event B
  geom_ellipse(data = B,
               aes(x0 = x0, y0 = y0, a = a, b = b, angle = angle),
               fill = "#2E86C1", alpha = 0.35, color = "#2E86C1", linewidth = 1) +
  # partition lines
  geom_segment(aes(x = cuts[1], xend = cuts[1], y = ylim[1], yend = ylim[2]),
               color = "black", linewidth = 0.7) +
  geom_segment(aes(x = cuts[2], xend = cuts[2], y = ylim[1], yend = ylim[2]),
               color = "black", linewidth = 0.7) +
  # labels
  annotate("text", x = 2.2, y = 3.1, label = "B ~ and ~ E[1]", size = 6, parse =  TRUE) +
  annotate("text", x = 5.0, y = 3.1, label = "B ~ and ~ E[2]", size = 6, parse = TRUE) +
  annotate("text", x = 8.2, y = 3.1, label = "B ~ and ~ E[3]", size = 6, parse = TRUE) +
  annotate("text", x = 1.0, y = 0.35, label = "E[1]", size = 6, parse = TRUE) +
  annotate("text", x = 5.0, y = 0.35, label = "E[2]", size = 6, parse = TRUE) +
  annotate("text", x = 8.0, y = 0.35, label = "E[3]", size = 6, parse = TRUE) +
  annotate("segment", x = 9.2, y = 5.5, xend = 7.5, yend = 4.9,
           arrow = arrow(length = unit(0.25, "cm")), linewidth = 0.7) +
  annotate("text", x = 8.8, y = 5.8, label = "Event B", hjust = 0, size = 5) +
  coord_fixed(xlim = xlim, ylim = ylim, expand = FALSE) +
  theme_void()


```


::: {.workedexample data-latex=""}

Suppose that approximately 7/100 adults in the US have diabetes and do not have cardiovascular disease, while 5/100 adults have both diabetes and cardiovascular disease.  What fraction of US adults have diabetes?

------------------------------------------------------

Let $B$ = {an individual has diabetes} and $A$ = {an individual has cardiovascular disease}. Then $P(B \text{ and } A^c) = 0.07$ while $P(B \text{ and } A) = 0.05.$  Using the rule of total probability in @eq-total-probability,
$$
P(B) =  P(B \text{ and } A) + P(B \text{ and } A^c) = 0.12.
$$
These data suggest that about 12% of adult Americans have diabetes.
:::

```{r ex-deg_wrk_status}
t = addmargins(prop.table(table(gen_ss$degree_status, gen_ss$work_status)))

t <- round(t, 3)
```

::: {.guidedpractice data-latex=""}

The prevalence of a disease is the probability that a member of a population has the disease.  Parkinson's disease (PD) is a neurodegenerative disorder with a prevalence that varies with age.  Studies have shown that in low- to upper-middle-income countries the age-related prevalence of PD is estimated to be 7 per 100,000 for individuals age 40-49, 158 per 100,000  in age 50 - 59, 603 per 100,000 in age 60 - 79, 1251 in age 70-79,and 2181 per 100,000 in age over 80. [@pereira2024systematic]  Assuming that the disease is so rare in individuals who are younger than 40 that the prevalence in that age group can be considered 0, what is the overall prevalence of PD?
[^probability-4]

:::

[^probability-4]: Using the general form of the law of total probability, the prevalence of PD is 
$$
\frac{1}{100000}(7 + 158 + 603 + 1251 + 2181) = `r 7 + 158 + 603 + 1251 + 2181`/100,000 = 0.042. 
$$

::: {.guidedpractice data-latex=""}

@tbl-gss-deg-work-prop from the General Social Survey shows the probabilities of work status and highest degree attained in school. What is the probability that (a) a respondent is working full or part time; (b) a respondent has a bachelor's or graduate degree; (c) has a bachelor's degree or higher and is unemployed or retired?
[^probability-5]
:::

[^probability-5]: (a) The probability is the sum of the elements in the first two columns, `r t[6,1] + t[6,2]`; (b) the sum of the last two rows, `r t[4,9] + t[5,9]`; (c) the sum of the values in the intersection of the last two rows and the columns for unemployed and retired, `r t[4,4] + t[4,5] + t[5,4] + t[5,5]`.


```{r tbl-gss-deg-work-prop}
#| label: tbl-gss-deg-work-prop
#| tbl-cap:  "Work status and highest degree earned"
#| tbl-pos: H
gen_ss |> 
  select(work_status, 
         degree_status) |> 
  count(work_status, degree_status) |> 
  mutate(prop = n /sum(n)) |> 
  select(-n) |> 
  pivot_wider(names_from = work_status, 
              values_from = prop,
              values_fill = 0) |> 
  kbl(linesep = "",
      booktabs = TRUE) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    latex_options = c("striped"),
    full_width = FALSE) |>
  add_header_above(c("Highest degree " = 1, "Work status" = 8)) |>
  column_spec(1, width = "5em") |>
  column_spec(2:8, width = "4em") 
  
  
```


::: {.important data-latex=""}
**Probability distributions.**

A  **probability distribution** \index{probability distribution} consists of all disjoint outcomes and their associated probabilities that satisfies the three rules:

* The outcomes listed must be disjoint.

* Each probability must be between 0 and 1.

* The probabilities must total to 1. 

:::

```{r}
terms_chp_3 <- c(terms_chp_3, c("rule of total probability",
                                "probability distributions")
)               
```

::: {.workedexample data-latex=""}

Suppose a random process consists of rolling  two six-sided dice.  (a) Create a table showing the possible outcomes of the roll and the probability distribution of the sum of the faces. (b) Show the distribution in a bar graph.

---------------------------------------------

(a) The first column of @tbl-sum-two-dice shows all 36 possible values of the roll of two dice, the sum for each value, and the associated probability of the value of the sum under the assumption that all 36 outcomes of the roll are equally  likely.

| Possible values of the two dice        | Sum | Probability |
|:--------------------------------------|:-----|:-------------|
| (1,1)                                |  2  | 1/36 = 0.029 |
| (1,2), (2,1)                         |  3  | 2/36 = 0.056 |
| (1,3), (2,2), (3,1)                  |  4  | 3/36 = 0.083 |
| (1,4), (2,3), (3,2), (4,1)           |  5  | 4/36 = 0.111 |
| (1,5), (2,4), (3,3), (4,2), (5,1)    |  6  | 5/36 = 0.139 |
| (1,6), (2,5), (3,4), (4,3), (5,2), (6,1) | 7 | 6/36 = 0.167 |
| (2,6), (3,5), (4,4), (5,3), (6,2)    |  8  | 5/36 = 0.139 |
| (3,6), (4,5), (5,4), (6,3)           |  9  | 4/36 = 0.111 |
| (4,6), (5,5), (6,4)                  | 10  | 3/36 = 0.083 |
| (5,6), (6,5)                         | 11  | 2/36 = 0.056 |
| (6,6)                                | 12  | 1/36 = 0.029 |

: Probability distribution for the sum of two dice {#tbl-sum-two-dice} 

  It is important to note that the 11  outcomes for the sum of the two dice are not equally likely.  

(b) @fig-sum-two-dice is a bar graph in which the height of each bar is the probability of the corresponding value of the sum.  The graph has the same appearance as a bar graph showing the relative frequency of a variable, such as the carapace colors in @fig-crabs-counts-proportions, but there is an important distinction between the twp graphs. @fig-crabs-counts-proportions shows the distribution of data collected as part of a completed study; @fig-sum-two-dice shows a theoretical probability distribution for the sum of two dice before any data has been collected. 

```{r sum-two-dice}
#| label: fig-sum-two-dice
#| out-width: 70%
#| fig-cap: | 
#|     Bar graph showing the probability distribution for the sum of two dice.

# Create data frame for the distribution
dice_data <- data.frame(
  Sum = 2:12,
  Probability = c(1,2,3,4,5,6,5,4,3,2,1) / 36
)

# Create bar plot
ggplot(dice_data, aes(x = factor(Sum), y = Probability)) +
  geom_bar(stat = "identity", 
           fill = IMSCOL["blue", "full"]) +
  labs(x = "Sum of the two dice",
       y = "Probability") 
```

:::

The proportions in @tbl-gss-deg-work-prop also comprise a probability distribution, but one that cannot easily be put into a bar chart.

Suppose now as in the example with age and health status, $B$ = {health rating good} and $E$ = {respondent is age 26 - 45}.  The probability $P(B \text{ and } E)$ is the value in @tbl-gss-age-health-prop in the intersection of the shaded second row, and second column shown in @tbl-gss-age-health-prop-shaded, or `r tbl_age_health_prop[2,2]`.  What about $P(B \text{ or }E)$? The events $B$ and $E$ are not disjoint so the addition rule for disjoint events does not apply.  Adding together the sum of second row and second column (`r  tbl_age_health_prop[2,5] + tbl_age_health_prop[5,2]`) includes the proportion for {age 26-45 and health rating good} twice, so it must be subtracted once:
\begin{align*}
P(B \text{ or } E) &= P(B) + P(E) - P(B \text{ and } E) \\
    &= `r tbl_age_health_prop[2,5]` + `r tbl_age_health_prop[5,2]` - `r tbl_age_health_prop[2,2]` \\
    &= `r tbl_age_health_prop[2,5] + tbl_age_health_prop[5,2] - tbl_age_health_prop[2,2]`.
\end{align*}


```{r tbl-gss-age-health-prop-shaded}
#| label: tbl-gss-age-health-prop-shaded
#| tbl-cap:  "Health rating and age group, with counts replaced by proportions"
#| tbl-pos: H
gen_ss |> 
  select(age_group, 
         health_status) |> 
  count(age_group, health_status) |> 
  mutate(prop = n /sum(n)) |> 
  select(-n) |> 
  pivot_wider(names_from = health_status, 
              values_from = prop,
              values_fill = 0) |> 
  adorn_totals(where = c("row", "col"), name = "Sum") |> 
  kbl(linesep = "",
      booktabs = TRUE) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    latex_options = c("striped"),
    full_width = FALSE) |>
  add_header_above(c("Age " = 1, "Health rating" = 5)) |>
  column_spec(1, width = "4em") |>
  column_spec(2:5, width = "4em") |> 
  column_spec(6, bold = TRUE) |> 
  row_spec(5, bold = TRUE) |> 
  row_spec(2, background = "gray") |> 
  column_spec(3, background = "gray")
  
```

The calculation of $P(B \text{ or } E)$ illustrates to the General Addition Rule for Probabilities:

::: {.important data-latex=""}
**General addition rule for probabilities.**

If $A$ and $B$ are any two events, disjoint or not, then the probability that at least one of them will occur is
$$
P(A\text{ or }B) = P(A) + P(B) - P(A\text{ and } B),
$$ {#eq-general-addition-rule}
where $P(A \text{ and } B)$ is the probability that both events occur.

:::

```{r}
terms_chp_3 <- c(terms_chp_3, c("general addition rule of probability")
)               
```


The idea behind the general addition rule can be visualized in the Venn diagram in  @fig-gss-age-health-venn showing the relationship between the events {age 26 to 45} and {health rating good}.  The figure shows that there are 1896 + 2180 = 4076 outcomes in the event {age 26 to 45} and 4066 + 2180 = 6246  in the event {health rating good}.  Adding the two total outcomes 4076 + 6246 = 10322 double counts the 2180 in the overlap, so the number of outcomes in ({age 26 to 45} or {health rating good}) is 4076 + 6246 - 2180 = 8146.


```{r fig-gss-age-health-venn}
#| label: fig-gss-age-health-venn
#| out-width: 80%
#| fig-cap: | 
#|     Venn diagram showing the overlap between the events {age 26 to 45} and {health rating good}.  
#|     The two events are not disjoint.  
`Age 26 to 45` <- (gen_ss$age_group == "26 to 45") 
`Health rating good` <- (gen_ss$health_status == "good")
d <- data_frame(`Age 26 to 45`, `Health rating good`)

library(ggvenn)
p <- ggvenn(d, 
            fill_color = c(IMSCOL["blue", "full"], IMSCOL["red", "full"]),
            set_name_size = 4,
            auto_scale = FALSE)

add_sample_space(p) 

```





::: {.guidedpractice data-latex=""}

(a) Use @fig-gss-age-health-venn to calculate $P${age 26 to 45} and $P${health rating good}. (b) Confirm that the Venn diagram does indeed include all outcomes in the sample space  [^probability-6]
:::

[^probability-6]: (a) $P(\text{age 26 to 45}) = 0.162 + 0.186 = `r 0.162 + 0.186`$. $P(\text{health rating good}) = `r 0.186 + 0.347`$.
(b) The total outcomes shown in the figure is 1896 + 2180 + 4066 + 3592 = `r 1896 + 2180 + 4066 + 3592`, which is the size of the dataset.



::: {.workedexample data-latex=""}

Use the general addition rule and @tbl-gss-age-health-prop to calculate that someone is either 66 years or older or has rated their health as poor.  

-----------------------------------------
Let $A$ = {age 66+} and $F$ = {health rating poor}. Using @eq-general-addition-rule,

\begin{align*}
 P(A \text{ or } F) &= P(A) + P(F) - P(A \text{ and } F) \\
                    &= `r tbl_age_health_prop[4,5]` + `r tbl_age_health_prop[5,4]` - `r tbl_age_health_prop[4,4]` \\ 
                    &= `r tbl_age_health_prop[4,5] + tbl_age_health_prop[5,4] - tbl_age_health_prop[4,4]`.
\end{align*}

:::

::: {.guidedpractice data-latex=""}

What is the probability that (a) someone is older than age 46 and rates their health as poor and (b) they are either older than 46 or have rated their health as poor.  [^probability-8]

:::

[^probability-8]: Let $H$ = {age older than 46} and $F$ defined as above. (a) $P(H \text{ and } F)$ = `r tbl_age_health_prop[3,4]` + `r tbl_age_health_prop[4,4]` = 
`r tbl_age_health_prop[3,5] +  tbl_age_health_prop[4,4]`. (b) $P(H \text{ or } F) = P(H) + P(F) - P(H \text{ and } F)$ = `r tbl_age_health_prop[3,5]` + `r tbl_age_health_prop[4,5]` - `r (tbl_age_health_prop[3,5] +  tbl_age_health_prop[4,4])` = `r tbl_age_health_prop[3,5] +  tbl_age_health_prop[4,5] -  (tbl_age_health_prop[3,5] +  tbl_age_health_prop[4,4])`.


## Conditional probability {#sec-conditional-probability}


In 2024, The US CDC estimated that 11.3% of the US adult population had been diagnosed with type 2 diabetes and another 4.5% were living with undiagnosed diabetes^[Defined as the survey respondent reporting never having received a diabetes diagnosis from a healthcare provider but experiencing 8 to 24 hour fasting plasma glucose greater than or equal to 126 mg/dL or hemoglobin A1c greater than or equal to 6.5% from tests done with the respondent] [@gwira2024diabetes].  Epidemiologists label these proportions the \index{prevalence} **prevalence** of diabetes.  If the patients seen at a clinic are representative of the US population (a very strong assumption, indeed!) then the chance is between 4 and 5% that a health care provider will detect diabetes in an adult patient without a prior diagnosis. But this probability only applies if nothing else is known about the patient. The prevalence of type 2 diabetes varies with age, for instance.  If the provider knows the patient is between 20 and 39 years old,  how should they revise that chance of undiagnosed diabetes?

@tbl-age-diabetes-prevalence shows the prevalence of diabetes status for the three age groups 20 - 39, 40 - 59 and age 60 or older, and is based on data from the [US CDC November 2024 Data Brief](https://www.cdc.gov/nchs/products/databriefs/db516.htm). For instance, among members of the US population age 20 - 39, the proportions of members with diagnosed, undiagnosed  or no diabetes are 0.022, 0.013 and 0.964, respectively.  The chance that a patient between 20 and 39 has undiagnosed diabetes (0.013) is less than 1/3 that of randomly selected adult (0.045).  

| Age Group | Diagnosed | Undiagnosed | No Diabetes |
|-----------|----------:|------------:|------------:|
| 20–39     |     0.022 |       0.013 |       0.964 |
| 40–59     |     0.121 |       0.056 |       0.823 |
| $≥$ 60    |     0.205 |       0.068 |       0.727 |

: Type 2 diabetes status by age {#tbl-age-diabetes-prevalence} {tbl-colwidths="[25,25,25,25]"}



Suppose  $B$ is the event that a randomly selected member of the US adult population has been diagnosed with type 2 diabetes.  According to the CDC data, $P(B)$ =  0.113, or 11.3%. @tbl-age-diabetes-prevalence shows that if one adds the condition that the adult is between 20 and 39, that probability decreases to 0.022. The probability  has changed because, instead of sampling from the entire adult population, the random selection is from a reduced sample space, adults between 20 and 39 years old. In the language of probability, 0.022 is the \index{conditional probability} **conditional probability** that an individual has been diagnosed with diabetes, given that (or conditioning on) the person between 20 and 39 years old.   

Suppose $A$ is the event that a randomly selected individual between 20 and 39 years old.  In the notation of conditional probability $P(B | A)$ = 0.022.


::: {.important data-latex=""}
**Conditional probability.**

Let $A$ and $B$ be two events.  The conditional probability of $B$ given $A$, written $P(B | A)$, is the probability of $B$ occurring if it is known that $A$ has occurred.  

:::

The next example uses @tbl-age-diabetes-prevalence.

::: {.guidedpractice data-latex=""}

Suppose that an individual is age 40 - 59. What is the conditional probability they have been diagnosed diabetes?  What is the probability of undiagnosed diabetes?  [^probability-9]

:::

[^probability-9]:  Let $A$ = {an individual is age 40 to 59}, $B$ = {an individual has diagnosed diabetes}, $C$ = {an individual has undiagnosed diabetes}. The $P(B|A) = 0.212$ and $P(C|A) = 0.056$  


::: {.workedexample data-latex=""} 
In the example of rolling two dice in @sec-probability-rules, let $A$ ={the sum of the dice is 4} and $B$ = {the outcome of the roll was (2, 2)}.  What are (a) 
$P(B | A)$ and $P(A | B)$?

------------------------------------------------------------------------

(a) @tbl-sum-two-dice shows that if the sum is 4, the outcome of the roll must have been one of the ordered pairs (1, 3), (2, 2), or (3, 1). In this reduced sample space of 3 outcomes, they are equally likely so each of will have occurred occurred with probability 1/3 and $P(B|A) = 1/3$. 

(b) If it is known that the roll yielded (2, 2), then the sum must be 4, so $P(A|B) = 1.$  This is not a particularly practical example but it emphasizes that  $P(B|A)$ and $P(A|B)$ can be very different.
:::

Conditional probabilities can be calculated from tables such as @tbl-gss-age-health.  Suppose $A$ = {age 26 to 45}.  Conditioning on the event $A$ = {age 26 to 45} means calculating probabilities for reported health among the `r tbl_age_health[2,5]` respondents in that age group.  Conditional probabilities for a reported health rating will be the proportion of the observed outcomes among the number of respondents between 26 and 46. 

Conditioning on any other age group involves calculating proportions for outcomes in that age group.  These conditional probabilities will be the row proportions in a table based @tbl-gss-age-health, but with counts replaced by row proportions.  The  modified table is shown in @tbl-gss-age-health-row-prop.


```{r tbl-gss-age-health-row-prop}
#| label: tbl-gss-age-health-row-prop
#| tbl-cap:  "Row proportions for heath rating by age group"
#| tbl-pos: H
gen_ss |> 
  select(age_group, 
         health_status) |> 
  count(age_group, health_status) |> 
  group_by(age_group) |> 
  mutate(proportion = n / sum(n)) |>
  dplyr::select(-n)  |> 
  pivot_wider(names_from = health_status, 
              values_from = proportion) |> 
  adorn_totals(where = c("col"), name = "Sum") |> 
  kbl(linesep = "",
      booktabs = TRUE,
      digits = 3) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    latex_options = c("striped"),
    full_width = FALSE) |>
  add_header_above(c("Age " = 1, "Health rating" = 5)) |>
  column_spec(1, width = "4em") |>
  column_spec(2:6, width = "4em") 
```



Since conditional probabilities are simply probabilities recalculated in a reduced sample space, they satisfy the 4 properties of probability in @sec-probability-rules. 

@tbl-gss-age-health-prop and @tbl-gss-age-health-row-prop appear similar, but the values in the two tables correspond to different types of probabilities.  In @tbl-gss-age-health-prop the value in the second row, second column (`r tbl_age_health_prop[2,2]`) is $P$({age 26 to 45} and {health rating good}).  It is the proportion of respondents who fell simultaneously into that age and health status among all `r tbl_age_health[5,5]` respondents and is called a \index{joint probability} **joint probability** for the two outcomes. In @tbl-gss-age-health-row-prop the value in the second row, second column  is a **conditional probability**, the proportion of respondents rating their health good when restricted to (conditioned on) those in age group 26 to 45.  In @tbl-gss-age-health-prop the row sums in the last column show the probability of an age group among the respondents, regardless of health status; the column sums in the last row show the probabilities of health rating, regardless of age.  These probabilities are called **marginal probabilities** \index{marginal probability} for health rating and age.

This terminology is summarized in the following box:

::: {.important data-latex=""}
**Joint, conditional and marginal probabilities.**

Let $A$ and $B$ be two events in a sample space.  The joint probability of $A$ and $B$, $P(A \text{ and } B)$ is the probability that both will occur simultaneously. The conditional probability $P(B \mid A)$ is the probability of $B$ under the condition that $A$ is known to have occurred.  The marginal probability $P(B)$ is the probability that $B$ will occur without regard to whether $A$ has occurred, and similarly for $P(A)$.

:::

::: {.workedexample data-latex=""}

@sec-two-examples discussed the characteristics of rapid antigen self-tests for COVID-19.  Write the information provided using probability notation and identify which types of probabilities are and are not specified.  

------------------------------------------------------------------------

Let $A$ = {an individual has COVID-19} and $B$ = {the individual tests positive for the infection.}  The statement that of 100 individuals with the infection 80 will test positive is the conditional probability $P(B | A)$ = 0.80. The statement that when 100 people without the disease are tested, 98 will test negative is the conditional probability  $P(B^c | A^c)$ = 0.98.  The relevant conditional probabilities for an individual who has just tested are instead $P(A | B)$ and $P(A^c | B^c)$.  The introduction claims that under some assumptions, $P(A | B)$ = 0.20, while $P(A^c | B^c) \approx$ 1.0, so $P(A | B)$ is very different from $P(B | A)$.   

There are no marginal or joint probabilities: $P(A)$, the prevalence of COVID-19, $P(B)$, the prevalence of positive tests, and the joint probabilities $P(A \text{ and } B)$ or $P(A^c \text{ and } B^c)$ someone has the disease and tests positive or has the disease and tests negative.

:::

```{r}
t_joint_sex_wrk <-  round(prop.table(table(gen_ss$sex, gen_ss$work_status)), 3)
t_marg_sex_wrk <- addmargins(t_joint_sex_wrk)
t_cond_sex_wrk = round(prop.table(table(gen_ss$sex, gen_ss$work_status), 1), 3)
```


::: {.guidedpractice data-latex=""}

Do the following statements give information about joint, conditional or marginal probabilities? (a) In the General Social Survey   `r t_cond_sex_wrk[1,7] *100`% of females stated that their primary occupation was keeping house.  The corresponding figure for males was `r t_cond_sex_wrk[2,7] * 100`%.  (b) `r t_joint_sex_wrk[2,7] * 100`% of the respondents were males whose occupation was keeping house.  (c) `r t_marg_sex_wrk[3,7] * 100`% of the respondents reported that keeping house was their primary occupation.
[^probability-11]
:::

[^probability-11]: (a) Conditional probabilities, since these are the probabilities of keeping house given sex = female or sex = male. (b) A joint probability of being male and keeping house. (c) A marginal probability of keeping house.

Tables such as @tbl-gss-age-health-row-prop provide convenient summaries of conditional probabilities that depend on categorical variables.  The conditional probability for any reported health rating, given a respondent is age 66+ (for instance), can be read from the last row of the table, and the comparing the rows of the table shows how the conditional probabilities of health rating vary with age. In @sec-relationships-two-categorical tables with row proportions were used to explore the relationship between two categorical variables in the World Values Survey (e.g., @tbl-wvs-edu-health-row-prop).   Instead of showing a relationship in collected data, however, @tbl-gss-age-health-row-prop shows how probabilities vary across levels of a categorical variable.


The calculations of a row proportion suggests a formula for calculating conditional probabilities.  Suppose, for example, $A$ = {age 26 to 45} and  $B$ = {Health rating good}. The element in @tbl-gss-age-health-row-prop corresponding the $P(B \mid A)$ is  

\begin{aligned}
P(B \mid A) 
  &= \frac{\text{number of outcomes in } (B \text{ and } A)}{\text{number of outcomes in } A} \\
  &= \frac{\text{number of outcomes in } (B \text{ and } A) /{\text{total outcomes}}}
          {\text{number of outcomes in } A / {\text{total outcomes}}} \\
  &= \frac{P(B \text{ and } A)}{P(A)}.
\end{aligned}

::: {.important data-latex=""}
**Formula for conditional probability.**

Suppose $A$ and $B$ are events in a sample space.  Then as long as $P(A) > 0$
$$
  P(B \mid A) = \frac{P(B \text{ and } A)}{P(A)}.
$$ {#eq-conditional-probability}

:::

```{r}
terms_chp_3 <- c(terms_chp_3, c("conditional probability",
                                "prevalence",
                                "joint probability",
                                "marginal probability")
)               
```


In many texts @eq-conditional-probability serves as the definition of conditional probability.  In this text, @eq-conditional-probability is viewed as a way to calculate the conceptual definition given earlier.

::: {.workedexample data-latex=""}

In the United States, women live longer than men.   Approximately 7.4%  of the population are females age 80 or older (80+), while only 4.4% are males 80+ . Suppose that 50.5% of the US population are females. (a) Draw a Venn diagram showing the relationship between the events {selecting a female} and {selecting someone 80+ years old}, showing the sizes of the non-overlapping regions. Use the information in the Venn diagram to compute (b) the probability that a randomly sampled female is age 80+ and (c) the probability that a randomly sampled person age 80+ is a female. (d)  Explain these two conditional probabilities in terms that someone without a background in statistics would understand.

------------------------------------------------------------------------

It is best to begin by writing in probability notation what is known and what is being asked.  Let $A$ = {randomly selected person is alive at age 80 or older}, and $F$ = {randomly selected person is female}.  In the problem statement $P(F \text{ and } A)$ = 0.074, $P(F^c \text{ and } A)$ = 0.044, and $P(F)$ = 0.505. Part (a) asks for the Venn diagram showing the relationship between $A$ and $F$. Parts (b) and (c) ask for $P(A \mid F)$ and $P(F \mid A)$, respectively, while (d) asks for an explanation of the conditional probabilities that does not use the jargon of probability.

(a) It is best to begin by sketching the main features of a Venn diagram before calculating the probabilities of events. The  @fig-female-80plus-venn-blank shows an initial Venn diagram, emphasizing the relationship between the events but without the probabilities.  Since $P(F \text{ and } A) > 0$, there will be an overlap between the events, as shown in the diagram.  The white space surrounding the diagram represents individuals who are neither females or in the 80+ group (males who are less than 80 years old.)

```{r, include = FALSE}
# trying helper for plots from VennDiagram 

# Add a border that matches the VennDiagram grob's own viewport (the white box)
add_vd_border <- function(g,
                          pad = unit(0, "mm"),   # inset the frame if you want
                          col = "black",
                          lwd = 2,
                          draw_under = FALSE) {

  vp <- if (!is.null(g$vp)) g$vp else g$childrenvp  # work with either vp slot

  frame <- rectGrob(
    x = 0.5, y = 0.5,
    width  = unit(1, "npc") - 2 * pad,
    height = unit(1, "npc") - 2 * pad,
    gp = gpar(fill = NA, col = col, lwd = lwd),
    vp = vp
  )

  if (draw_under) grobTree(frame, g) else grobTree(g, frame)
}
```


```{r fig-female-80plus-venn-blank}
#| label: fig-female-80plus-venn-blank
#| out-width: 70%
#| fig-cap: | 
#|     Venn diagram showing the relationship between A = {age 80+} and F = {female}, without probabilities.
library(VennDiagram)
# Draw Venn diagram with specified areas
age_venn <-  draw.pairwise.venn(
  area1 = 0.505,     # set A
  area2 = 0.118,      # set B
  cross.area = 0.074, # overlap
  category = c("Female", "80+"),
  fill = c(IMSCOL["blue", "full"], IMSCOL["red", "full"]),
  lty = "blank",
  #cex = 1.5,
  cat.cex = 1.5,
  ext.text = TRUE,
  scaled = FALSE,
  cex = 0
)

grid.draw(add_vd_border(age_venn, pad = unit(1.5, "mm"), lwd = 2))
```

@fig-female-80plus-venn adds the probabilities to the diagram.  The slice in the middle is $P(F \text{ and } A)$ and is given as 0.074. The size of the blue area is $P(F \text{ and } A^c).$  By the rule of total probability (@eq-total-probability)
$$
  P(F) = P(F \text{ and } A) + P(F \text{ and } A^c),
$$
so 
$$
P(F \text{ and } A^c) = P(F) - P(F \text{ and } A) = 0.505 - 0.074 = 0.431.
$$

The red section on the right has size $P(F^c \text{ and } A)$, the probability that someone is 80+ and male, and is given as 0.44.


```{r fig-female-80plus-venn}
#| label: fig-female-80plus-venn
#| out-width: 70%
#| fig-cap: | 
#|     Venn diagram showing the relationship between A = {age 80+} and F = {female}, with probabilities.
library(VennDiagram)
# Draw Venn diagram with specified areas
age_venn <-  draw.pairwise.venn(
  area1 = 0.505,     # set A
  area2 = 0.118,      # set B
  cross.area = 0.074, # overlap
  category = c("Female", "80+"),
  fill = c(IMSCOL["blue", "full"], IMSCOL["red", "full"]),
  lty = "blank",
  #cex = 1.5,
  cat.cex = 1.5,
  ext.text = TRUE,
  scaled = FALSE,
  cex = 1.5
)

grid.draw(add_vd_border(age_venn, pad = unit(1.5, "mm"), lwd = 2))
```

(b) The conditional probability that a randomly sampled female is 80+ is the conditional probability of being in that age group, given that the sampled person is female, $P(A \mid F)$.  
\begin{align*}
P(A \mid F) &= \frac{P(F \text{ and } A)}{P(F)} \\
            &= \frac{0.074}{0.505} \\
            &= 0.147.
\end{align*}


(c) The conditional probability $P(F \mid A)$ is 
\begin{align*}
P(F \mid A) &= \frac{P(F \text{ and } A)}{P(A)} \\
            &= \frac{0.074}{0.074 + 0.044} \\
            &= 0.627.
\end{align*}


(d)  Part (b): Approximately 15% of the females in the US are at least 80 years old.  Part (c): Among the elders in the US who are at least 80 years old, approximately 63% are female.  So a majority of people in the US at least 80 years old are female.  Women do indeed live longer than men.

:::

::: {.guidedpractice data-latex=""}

In the above example what population is represented by the white space outside the ovals in @fig-female-80plus-venn?  What is the probability if selecting someone 
from that population?[^probability-330]

:::

[^probability-330]: The population represented by the white space are neither female nor age 80+.  They are the males  less than 80 years old.  The probability in that region is 1 minus the total area in the ovals, 1 - (0.431 + 0.074 + 0.044) = 0.451.  Approximately 45% of the US population are males less than 80 years old.


A simple rearrangement of the the formula for conditional probability yields the multiplication rule for probabilities.

::: {.important data-latex=""}
**Multiplication rule for probabilities.**

If $A$ and $B$ be two events in a sample space, then
$$
P(B\text{ and } A) = P(B | A)P(A).
$${#eq-mult-rule-two-probs}
::: 
 
::: {.workedexample data-latex=""}

Suppose that among male adults between 25 and 40 years of age, hypertension occurs about 18% of the time. For simplicity assume that the population is 50% male, 50% female. What is the probability of randomly selecting a male with hypertension from the population of individuals 25-40 years of age?

------------------------------------------------------------------------

Let $A$ be the event that a person has hypertension, and $B$ the event that they are a male adult between 25 and 40 years of age. $P(A|B)$, the probability of hypertension given male sex, is 0.18. Thus, $P(A \text{ and } B) = (0.18)(0.50) = 0.09$.
:::

The conditional probability $P(B \mid A)$ quantifies how knowing that $A$ has occurred changes the chance of $B$ happening.  When $P(B)$ and $P(B \mid A)$ are the same, knowing that $A$ has occurred provides no information about the chance of $B$.  In that case, $A$ and $B$ are called **statistically independent** \index{independent}.


::: {.important data-latex=""}
**Independent events.**

Two events $A$ and $B$ in a  sample space are independent when 
$$
  P(B \mid A) = P(B).
$${#eq-independence-definition}
::: 

Applying the multiplication rule to two independent events $A$ and $B$ yields an alternative definition for independent events:
$$
 P(B\text{ and } A) = P(B \mid A)P(A) = P(B)P(A).
$${#eq-two-independent-events}

Similarly, if there are $k$ events $A_1$, ..., $A_k$ from $k$ independent processes, then the probability they all occur is
$$
P(A_1) P(A_2) \cdots P(A_k).
$${#eq-k-independent-events}

Independence for two events can be checked using either  @eq-independence-definition or @eq-two-independent-events. 

::: {.workedexample}

In the US population, 45% of the of people are blood group O. Suppose that 40% of Asian people living in the US are blood group O, and that the Asian population in the United States is approximately 4%. Do these data suggest that blood group is independent of ethnicity?

---------------------------------------

Let $B$ represent blood group O, and $A$ represent Asian ethnicity. Since $P(B|A) = 0.40$ does not equal $P(B) = 0.45$, the two events are not independent.   Alternatively, 
\begin{align*}
P(A \text{ and } B) &= P(B |A)P(A) \\
    &= (0.40)(0.04) \\
    &\neq (0.45)(0.04) \\
    &= P(B)P(A).
\end{align*}
Blood group is not independent of ethnicity.

:::

::: {.guidedpractice data-latex=""}

**Independent versus disjoint events.**  Suppose you pick a day at random from the annual calendar of 365 days, and let $A$ = {the day chosen is in October} and $B$ = {the day chosen is in summer}.  Are $A$ and $B$ independent?  Are they disjoint? 
[^probability-301]

:::

[^probability-301]: $A$ and $B$ are not independent since $P(B)$ = 1/12 (approximately) but $P(B|A) = 0,$ since a day in October cannot be a day in summer.  The two events are disjoint, however, since both $A$ and $B$ cannot happen simultaneously.

::: {.guidedpractice data-latex=""}

Is the event of drawing a heart from a deck of cards independent of drawing an ace? [^probability-302]

:::

[^probability-302]:The probability the card is a heart is 13/52 = 1/4  and the probability that it is an ace is 4/52=1/13. The probability that the card is the ace of hearts $\text{A}{\heartsuit}$) is 1/52. Check whether @eq-two-independent-events is satisfied: $$P({\heartsuit}) P(\text{A}) = \left(\frac{1}{4} \right) \left( \frac{1}{13} \right) = \frac{1}{52} 
= P({\color{redcards}\heartsuit}\text{A}).$$  Since the equation holds, the event that the card is a heart and the event that the card is an ace are independent events.



::: {.workedexample data-latex=""}

Mandatory drug testing in the workplace is common practice for certain professions, such as air traffic controllers and transportation workers.  A false positive in a drug screening test occurs when the test incorrectly indicates that a screened person is an illegal drug user. Suppose a mandatory drug test has a false positive rate of 1.2% (i.e., has probability  0.012 of indicating that an employee is using illegal drugs when that is not the case).  Given 150 employees who are in reality drug free, what is the probability that at least one will falsely test positive? Assume that the outcome of one drug test has no effect on the others.

------------------------------------------------------------------------

First, note that the complement of at least 1 person testing positive is that no one tests positive (i.e., all employees test negative). The multiplication rule can then be used to calculate the \begin{align*}
P(\text{At least 1 } \texttt{+}) 
  &= P(\text{1 or 2 or 3 } \cdots \text{ or 150 are } \texttt{+}) \\
  &= 1 - P(\text{None are } \texttt{+}) \\
  &= 1 - P(\text{150 are } \texttt{-}) \\
  &= 1 - P(\texttt{-})^{150} \\
  &= 1 - (0.988)^{150} \\
  &= 1 - 0.16 \\
  &= 0.84.
\end{align*}
 Even when using a test with a small probability of a false positive, the company is more than 80\% likely to incorrectly claim at least one employee is an illegal drug user!

:::

::: {.guidedpractice data-latex=""}

Because of the high likelihood of at least one false positive in company wide drug screening programs, an individual with a positive test is always re-tested with a different screening test: one that is more expensive than the first, but has a lower false positive probability. Suppose the second test has a false positive rate of 0.8%.  What is the probability that an employee who is not using illegal drugs will test positive on both tests? [^probability-303]
:::

[^probability-303]: The outcomes of the two tests are independent of one another; $P (A\text{ and } B) = P(A) P(B)$, where events $A$ and $B$ are the results of the two tests. The probability of a false positive with the first test is 0.012 and 0.008 with the second. Thus, the probability of an employee who is not using illegal drugs testing positive on both tests is $(0.012) (0.008) = (9.6) 10^{-5}.$

::: {.workedexample data-latex=""}


**ABO blood groups** There are four different common blood types (A, B, AB, and O) that are are determined by the presence of certain antigens located on cell surfaces. Antigens are substances used by the immune system to recognize self versus non-self; if the immune system encounters antigens not normally found on the body's own cells, it will attack the foreign cells. When patients receive blood transfusions, it is critical that the antigens of transfused cells match those of the patient's, or else an immune system response will be triggered.

The ABO blood group system consists of four different blood groups, which describe whether an individual's red blood cells carry the A antigen, B antigen, both, or neither. The ABO gene has three alleles: ${I}^{A}$, ${I}^{B}$, and *i*. The *i* allele is recessive to both ${I}^{A}$ and ${I}^{B}$, and does not produce antigens; thus, an individual with genotype ${I}^{A}i$ is blood group A and an individual with genotype ${I}^{B}i$ is blood group B. The ${I}^{A}$ and ${I}^{B}$ alleles are codominant, such that individuals of ${I}^{A}$${I}^{B}$ genotype are AB. Individuals who inherit two copies of the \textit{i} allele are known as blood group O, with neither A nor B antigens. @fig-abo-inheritance shows graphically how inheritance determines blood group.

```{r abo-inheritance}
#| label: fig-abo-inheritance
#| out-width: 70%
#| fig-cap: |
#|   Pattern of inheritance of the genes that determine one of the four different common blood types (A, B, AB, and O)
#| fig-alt: |
#|   
#| fig-pos: H
knitr::include_graphics("images/abo-inheritance.png")
```

Suppose that both members of a couple have Group AB blood.	(a) What is the probability that a child of this couple will have Group A blood? (b) What is the probability that they have two children with Group A blood?


------------------------------------------------------------------------

(a) An individual with Group AB blood is genotype ${I}^{A}$${I}^{B}$. Two ${I}^{A}$${I}^{B}$ parents can produce children with genotypes ${I}^{A}$${I}^{B}$, ${I}^{A}$${I}^{A}$, or ${I}^{B}$${I}^{B}$. Of these possibilities, only children with genotype ${I}^{A}$${I}^{A}$ have Group A blood. Each parent has 0.5 probability of passing down their ${I}^{A}$ allele. Thus, the probability that a child of this couple will have Group A blood is P(parent 1 passes down ${I}^{A}$ allele) $\times$ P(parent 2 passes down ${I}^{A}$ allele) = $(0.5)(0.5) = 0.25$.

  (b) Inheritance of alleles is independent between children. Thus, the probability of two children having Group A blood equals P(child 1 has Group A blood) $\times$ P(child 2 has group A blood). The probability of a child of this couple having Group A blood was previously calculated as 0.25, so the answer is $(0.25)(0.25) = 0.0625$.
	
:::

```{r}
terms_chp_3 <- c(terms_chp_3, c("multiplication rule",
                                "independent events")
)
```



## Bayes' Rule {#sec-bayes-rule}

@sec-two-examples opened this chapter with a question about the likelihood of a COVID-19 Rapid Antigen Test (RAT) correctly predicting the presence of the virus.  Let {COVID-19} denote the event that someone has the virus and {RAT^+^} denote a positive self-test. Suppose, as in @sec-two-examples, the probability of a positive test in a person with the virus is 0.80 (80%). In the language of conditional probability, 
$$
P(\text{RAT}^+ \mid \text{COVID-19}) = 0.80.
$${#eq-rat-sensitivity}

The likelihood of a positive test correctly predicting the presence of the virus is the reverse conditional probability:
$$
P(\text{COVID-19} \mid \text{RAT}^+).
$${#eq-rat-ppv}

From earlier examples, it is clear that it would be wrong to assume these two conditional probabilities are equal.

The solution to this problem is an important application of probability to diagnostic medicine.  In clinical care settings, diagnostic tests that return positive or negative values (disease present or absent) are frequently used to screen for  underlying conditions. ^[@Mukherjee2025EarlyDetection provides an interesting and readable account of current issues in screening for cancer.]

Specific terminology is used to describe behavior of diagnostic tests.  Suppose $D$ denotes the presence of a disease and $D^C$ its absence.  Let $T^+$ and $T^-$ denote the events of a positive and negative diagnostic test, respectively.

* The **prevalence** of a disease $D$ is the proportion of individuals in a population with the disease.  It is the probability that a randomly chosen member of a population has the disease and is denoted by $P(D)$.

* The **sensitivity** \index{sensitivity} of $T$ is the conditional probability $P(T^+ \mid D)$.  If someone has the disease, how often is the test positive?  Sensitivity is also called the probability of a true positive for the test.

* The **specificity** \index{specificity} of $T$ is the conditional probability $P(T-\mid D^C)$. If someone does not have the disease,  how often is the test negative?  Specificity is the probability of a true negative.

* The the **positive predictive value (PPV)** \index{positive predictive value} of the test $T$ is the conditional probability $P(D \mid T^+)$.  If a test is positive, how often is the disease present?

* The **negative predictive value (NPV)** \index{negative predictive value} of $T$ is the conditional probability $P(D^C \mid T^-)$.  If $T$ is negative, how often is the disease truly absent?

@eq-rat-sensitivity posits a sensitivity for a RAT, while @eq-rat-ppv is its positive predictive value.   How does the PPV of a test depend on its sensitivity?  This section discusses three approaches to calculating the PPV of a test: the use of tree diagrams, an application of Bayes' Rule,  and the construction of a hypothetical population where a 2$\times$2 table can be used to calculate conditional probabilities from counts, as in @sec-conditional-probability.  

In addition to the sensitivity of a diagnostic test, all three methods depend on the specificity of the test (the probability of a true negative) and the prevalence of the disease. For the COVID-19 example,  the calculations assume $P(\text{RAT}^- \mid \text{COVID-19}^C)$ = 0.98, the probability of a true negative cited in @sec-two-examples. The prevalence of COVID-19 changes seasonally and among regions.  Initially the solution provided here assumes the infection is present in 5% of a population, so $P(D)$ = 0.05.  But it is important to examine how the PPV changes with prevalence, and that is explored later. 

**Tree diagrams**

A **tree diagram** \index{tree diagram} is especially useful when two or more processes occur in a sequence, with the conditional probability of each outcome depending the preceding outcomes.  The tree provides a scheme for computing joint probabilities.

```{r}
# ppv for covid RAT
# also used and repeated later
# 

sens_rat <- 0.80
spec_rat <- 0.98
prev_covid <- 0.05
```

In @fig-rat-tree, the first branches (called the primary branches) of the tree split the population by COVID-19 status, and show the marginal probabilities 0.05 and 0.95 of having or not having the infection. The secondary branches show conditional probabilities determined by the primary branches; for example, the top branch is the conditional probability of a positive RAT given that an individual has the infection. The secondary branch below it shows the conditional probability of a negative test, given the disease is present.  A negative test when the disease is present is the complement of a positive test and has probability 1 - 0.20 = 0.80.  The values along the other branches are calculated similarly.

```{r rat-tree}
#| label: fig-rat-tree
#| out-width: 80%
#| fig-cap: | 
#|     Tree diagram for the behavior of COVID-19 self-tests (RATs)
treeDiag(c('COVID-19', 'RAT Self test'),
         c(0.05, 0.95),
         list(c(0.80, 0.20),
              c(0.02, 0.98)),
         textwd = 0.2,
         solwd = 0.35,
         cex.main = 1.4,
         c('present', 'absent'),
         c('positive','negative'),
         digits = 5,
         col.main = COL[1],
         showWork = TRUE)
```


Joint probabilities are calculated at the end of each branch by multiplying the numbers from right to left, using the Multiplication Rule for Probabilities, @eq-mult-rule-two-probs. For instance, the probability of having the infection and testing positive is the conditional probability of testing positive given COVID-19 is present times the probability COVID-19 is present:

\begin{align*}
P(\text{COVID-19 and RAT$^+$}) &= P(\text{RAT$^+$ } |\ \text{COVID-19}) \times  P(\text{COVID-19}) \\
	&= (0.80) (0.05) \\ 
	&= 0.04.
\end{align*}

The rest of the joint probabilities are calculated the same way.

The tree diagram can be used to calculate the PPV of a RAT, 
$$
P(\text{COVID-19} \mid \text{RAT}^+) = \frac{P(\text{COVID-19 and RAT}^+)}
{P(\text{RAT}^+)}. 
$$

The numerator is the probability of the top branch, 0.04.  The denominator is the sum of the probabilities along the two branches that lead to a positive RAT: either a true positive when having COVID-19, 0.04, or a false positive in the absence of the infection, 0.019.  So $P(\text{RAT}+)$ = 0.059. The PPV is the ratio 0.04/0.059 = 0.678.  With a positive self-test, the chance of COVID-19 is 68% under the assumption that the prevalence of the infection is 5%.


```{r}
# ppv for covid RAT
# also used and repeated later
# 

sens_rat <- 0.80
spec_rat <- 0.98
prev_covid_03 <- 0.03


ppv_rat_03 <- round((sens_rat * prev_covid_03)/(sens_rat * prev_covid_03 + (1 - spec_rat) * (1 - prev_covid_03)), 2)
npv_rat_03 <- round(spec_rat * (1 - prev_covid_03) /(spec_rat * 1 - prev_covid_03 + (1 - sens_rat) * prev_covid_03), 2)

prev_covid_08 <- 0.08
ppv_rat_08 <- round((sens_rat * prev_covid_08)/(sens_rat * prev_covid_08 + (1 - spec_rat) * (1 - prev_covid_08)), 2)
npv_rat_08 <- round(spec_rat * (1 - prev_covid_08) /(spec_rat * 1 - prev_covid_08 + (1 - sens_rat) * prev_covid_08), 2)
```


::: {.workedexample data-latex=""}

Under the assumptions above, use the tree diagram to calculate the negative predictive value (NPV) of a COVID-19 self-test.

------------------------------------------------------------------------

The NPV is 
$$
P(\text{COVID-19}^C) \mid \text{RAT}^-) = \frac{P(\text{COVID-19}^C \text{ and RAT}^-)}
{P(\text{RAT}^-)}.
$$  
The numerator is the value at the end of the lowest branch, 0.931.  The denominator is sum of the values on the two branches that lead to a negative test, 0.01 + 0.931 = 0.941.  The PPV is 0.931/0.941 = 0.989.  Under the assumptions used here, the chance that the infection is absent when a test is negative is 99%. 
:::

The PPV and NPV for COVID-19 self-tests calculated here match those claimed in @sec-two-examples but depend on the assumptions made about the test and the setting in which it is administered.  The sensitivity and specificity are characteristics of the test itself and do not change unless the technology of the test changes.  But the prevalence depends on the population using the test and may change with time or location.

::: {.workedexample data-latex=""}

(a)  What is the PPV of RAT if all of the characteristics of the test remain the same but the prevalence of COVID-19 is 0.03 instead of 0.05? 
(b)  What is the PPV if the prevalence is 0.08 instead of 0.05?

------------------------------------------------------------------------

a. If the prevalence decreases from 0.05 to 0.03, the probability of the top branch will be (0.03)(0.80) = 0.24. The probability of a positive RAT will be (0.03)(0.80) + (0.97)(0.98) = 0.975.  The PPV will be 0.24/0.975 = 0.246.  The chance of COVID-19 is only 25% when a self-test is positive but the prevalence of the infection is 3%.

b. When the prevalence is 0.08 (8%), the 
\begin{align*} 
\text{PPV}  &= \frac{(0.08)(0.80)} {(0.08)(0.80) + (0.92)(0.02)} \\
&= 0.777
\end{align*}
The chance of COVID-19 after a positive test increases to 78% when the prevalence of the infection is 8% instead of 5%.

The chance you have COVID-19 after a positive test depends on how many people around you are infected as well as the quality of the test.  The reasons for this will be explored later.
:::


**Bayes' Rule**

Bayes' Rule provides a formula for calculating conditional probabilities when the the event of interest and conditioning event are reversed, as in sensitivity and PPV. 

::: {.important data-latex=""}
**Bayes' Rule, short version**[^probability-341]

[^probability-341]: @eq-bayes-rule is a direct application of the definition of conditional probability and the multiplication rule.
$$
 P(B \mid A) = \frac{P(B \text{ and } A)}{P(A)} = \frac{P(A \mid B)P(B)}{P(A)}.
$$


Suppose $A$ and $B$ are two events in a sample space.  Then

$$
P(B \mid A) = \frac{P(A \mid B) P(B)}{P(A)}. 
$${#eq-bayes-rule}


::::

Bayes' Rule applied to a diagnostic test shows how PPV depends on the characteristics of a test and the prevalence of the disease.
If $A = T^+$ and $B = D$, @eq-bayes-rule becomes 
$$
P(D \mid T^+) = \frac{P(T^+ \mid D) P(D)}{P(T^+)}. 
$${#eq-bayes-testing}

@eq-bayes-testing shows that the PPV of $T$ depends on its sensitivity $P(T^+ \mid D)$, the prevalence $P(D)$ of $D$, and the likelihood of a positive test in the population.  Then chance of a positive test is rarely specified in advance, but can be calculated using the characteristics of the test and the prevalence of $D$:
\begin{align*}
P(T^+) &= P(T^+ \text{ and } D) + P(T^+ \text{ and } D^C) \\
       &= P(T^+ \mid D)P(D) + P(T^+ \mid D^C)P(D^C) \\
\end{align*}
The first line uses the Rule of Total Probability (@eq-total-probability) and the second the Multiplication Rule (@eq-mult-rule-two-probs).

Using this expression for the denominator in @eq-bayes-testing,  
$$
\text{PPV} = \frac{P(T^+ \mid D) P(D)}{P(T^+ \mid D)P(D) + P(T^+ \mid D^C)P(D^C)}.
$${#eq-bayes-testing-expanded}

@eq-bayes-testing-expanded leads to a useful mnemonic often used in medicine and public health for the PPV of diagnostic test:

$$
\text{PPV} = \frac{\text{sensitivity } \times \text{ prevalence}}{[\text{sensitivity } \times \text{ prevalence}] + [\text{(1 - specificity) } \times \text{ (1 - prevalence)}]}.
$${#eq-bayes-ppv-mnemonic}

The negative predictive value (NPV) of a diagnostic test is the conditional probability $P(D^C \mid T^-)$.  Bayes' Rule can be used to show
$$
\text{NPV} = \frac{\text{specificity } \times (\text{1 - prevalence})}{[(\text{1 - sensitivity}) \times \text{ prevalence}] + [\text{specificity } \times \text{ (1 - prevalence)}]}.
$${#eq-bayes-npv-mnemonic}

These are not formulas to memorize -- it would be too easy to get them confused.  But they are useful they have been recorded.

::: {.guidedpractice data-latex=""}

Some congenital disorders are caused by errors that occur during cell division, resulting in the presence of additional chromosome copies. Trisomy 21 (Down syndrome) occurs in approximately 1 out of 800 births. Cell-free fetal DNA (cfDNA) testing is one commonly used way to screen fetuses for trisomy 21. The test sensitivity is 0.98 and the specificity is 0.995. Calculate the PPV and NPV of the test. [^probability-440]
:::

[^probability-440]:
\begin{align*}
\text{PPV} &= \frac{\text{sensitivity } \times \text{ prevalence}}{[\text{sensitivity } \times \text{prevalence}] + [\text{(1 - specificity) } \times \text{ (1 - prevalence)}]} \\
&= \frac{(0.98)(1/800)}{(0.98)(1/800) + (1 - 0.995)(799/800)} \\
&= 0.197
\end{align*}
\begin{align*}
\text{NPV} &= \frac{\text{specificity } \times (\text{1 - prevalence})}{[\text{(1 - sensitivity)} \times \text{prevalence}] + [\text{specificity} \times \text{(1 - prevalence})]} \\
&= \frac{(0.995)(799/800)}{(1-0.98)(1/800) + (0.995)(799/800)} \\
&= 0.999975
\end{align*}
The test has low positive predictive value but high negative predictive value.

::: {.guidedpractice data-latex=""}

If your were counseling parents whose fetus will be tested for Trisomy 21 using cfDNA, what would you tell them in advance about interpreting the outcome of the test, without using any of the jargon from probability?
[^probability-441]
:::

[^probability-441]: Here is one possible script: Since you have no special risk factors for Down syndrome in an infant,  your overall chance of having an affected infant is about 1/800, approximately one tenth of 1%. The test we use to screen for the congenital mutation is the best we have, but it is not perfect. If the test is negative (sugggesting the mutation is not present) there is a 99.5% chance that your infant will not be affected.  If it is positive, then there is about a 20% chance the mutation is present.  So a negative test would be very good news.  A positive test is not necessarily bad news: it will suggest that the chance is about 1 in 5 that your infant will be affected.  Do you have any questions?

@eq-bayes-testing-expanded is a specific example of more general versions of Bayes' rule:

::: {.important data-latex=""}
**Bayes' rule, full version.**

Suppose $A$ and $B$ are events in a sample space.  Then
$$
  P(B \mid A) = \frac{P(A \mid B) P(B)}{P(A \mid B) P(B) + P(A \mid B^C) P(B^C)}.
$${#eq-bayes-trad}
More generally suppose that $B = (B_1 \text{ and } B_2  \cdots \text{ and } B_k)$, where the events $B_1, B_2, \cdots, B_k$ are disjoint.  Then 

$$
P(B \mid A) = \frac{P(A | B_1) P(B_1)}
	{P(A | B_1) P(B_1) + P(A | B_2) P(B_2) + \cdots + P(A | B_k) P(B_k)}.
$$ {#eq-bayes-trad-gen}

:::

The most general form of Bayes' rule will be used in @sec-cat-genetics, an extended example of using conditional probability in a genetics problem.

**Contingency tables**

```{r}
# code for contingency tables

prev_ct_05 <- 0.05
sens_ct <- 0.80
spec_ct <- 0.98
N_ct <- 100000

covid_cases_05 <- prev_ct_05 * N_ct 
covid_absent_05 <- N_ct - covid_cases_05
t_pos_05 <- covid_cases_05 * sens_ct
f_neg_05 <- covid_cases_05 * (1 - sens_ct)
t_neg_05 <- covid_absent_05 * spec_ct
f_pos_05 <- covid_absent_05 * (1 - spec_ct)
tot_pos_05 <-  t_pos_05 + f_pos_05
tot_neg_05 <- t_neg_05 + f_neg_05

ppv_05 <- round(t_pos_05 / tot_pos_05, 3)


```

The positive predictive value (PPV) of a diagnostic test can be calculated by constructing a 2 $\times$ 2contingency table for a large, hypothetical population and calculating conditional probabilities by conditioning on rows or columns. Using a large enough hypothetical population results in an empirical estimate of PPV that is very close to the exact value obtained via using the previously discussed approaches.

The method begins by constructing an empty $2 \times 2$ table, with the possible outcomes of the diagnostic test as the rows, and the possible disease statuses as the columns as in @tbl-rat-setup. The table should include cells for the row and column sums.


|               | COVID-19 Present | COVID-19 Absent  | Sum     |
|---------------|------------------|------------------|---------|
| RAT Positive | --                | --               | --      |
| RAT Negative | --                | --               | --      |
| Sum          | --                | --               | 100,000 |

: A 2 \times 2 table for the COVID RAT test example with a hypothetical population size $N$ of 100,000 {#tbl-rat-setup} 

Continue populating the table with the following steps, using the information in @fig-rat-tree:

* An assumed prevalence of 5%

* An 80% chance of a true positive and 20% of a false negative

* A 98% chance of a true negative and 2% of a false positive

1.  Calculate the two column totals (the number of individuals with and without COVID-19) from $P(\text{COVID-19})$, the infection prevalence:
	$$N \times P(\text{COVID-19}) = 100,000 \times .05 = 5,000 \text{ individuals with COVID-19}.$$
	$$N \times [1 - P(\text{COVID-19})] = 100,000 \times [1 - 0.05] = 95,000 \text{ individuals without COVID-19}.$$
	
	Alternatively, the number of individuals without COVID-19 can be calculated by subtracting the number with COVID-19 from $N$.
	
2. Calculate the two numbers in the first column: the number of individuals with COVID-19 testing either positive (true positive) or negative (false negative).
	$$\text{COVID-19 infected} \times P(\text{true positive}) = 5,000 \times 0.80 = 4,000 \text{ true positives}$$
	$$\text{COVID-19 infected} \times P(\text{false negative}) = 5,000 \times 0.20 = 1,000 \text{ false negatives}$$
	
3. Calculate the two numbers in the second column: the number of individuals without the infection testing either positive (false positive) or negative (true negative). 
	$$\text{COVID-19 uninfected} \times P(\text{false positive}) = 95,000 \times 0.02 = 1,900 \text{ false positives}$$
	$$\text{COVID-19 uninfected} \times P(\text{true negative})] = 95,000 \times 0.98 = 93,100 \text{ true negatives}$$
	
4.  Complete the table by calculating the two row totals: the number of positive and negative mammograms out of 100,000.
	$$(\text{true positives}) + (\text{ false positives}) = 4,000 + 1,900 = 5,900 \text{ positives}$$
	$$(\text{true negatives}) + (\text{false negatives}) = 93,100 + 1,000 = 94,100 \text{ negatives}$$
	
5.  Finally, calculate the PPV of the RAT test using the ratio of the number of true positives to the total number of positive tests. This estimate is more than accurate enough, with the estimated value matching the exact calculation up to the third decimal place. 
	
	$$\frac{\text{ true positive tests}}{\text{ positive tests}} = \frac{`r t_pos_05`}{`r tot_pos_05`} = `r ppv_05`. $$


|             | COVID-19 Present | COVID-19 Absent | Sum     |
|-------------|------------------:|---------------:|---------:|
| RAT Positive | `r t_pos_05`     | `r f_pos_05`         | `r tot_pos_05`  |
| RAT Negative | `r f_neg_05`     | `r t_neg_05`          | `r tot_neg_05`  |
| Sum          | `r covid_cases_05` | `r covid_absent_05` | `r N_ct` |

: A 2 \times 2 table for the COVID RAT test example with a hypothetical population size $N$ of 100,000 and prevalence 5%, with numbers added {#tbl-rat-complete} 

@tbl-rat-complete and the calculations to fill in the cells provide a more concrete interpretation of PPV.  The positive predictive value of a diagnostic test is the fraction of the number of instances of a true positive test out of all tests that would be positive, including the false positive outcomes.  If you are a member of the subset of the population testing positive, how likely is it that you have a true positive?  This interpretation can be used to explore the effect prevalence on PPV.

```{r}
# code for contingency tables

prev_ct_01 <- 0.01
sens_ct <- 0.80
spec_ct <- 0.98
N_ct <- 100000

covid_cases_01 <- prev_ct_01 * N_ct 
covid_absent_01 <- N_ct - covid_cases_01
t_pos_01 <- covid_cases_01 * sens_ct
f_neg_01 <- covid_cases_01 * (1 - sens_ct)
t_neg_01 <- covid_absent_01 * spec_ct
f_pos_01 <- covid_absent_01 * (1 - spec_ct)
tot_pos_01 <-  t_pos_01 + f_pos_01
tot_neg_01 <- t_neg_01 + f_neg_01

ppv_01 <- round(t_pos_01 / tot_pos_01, 3)


```

@tbl-rat-complete-01 shows the behavior of a RAT if the COVID-19 prevalence is 0.01 instead of 0.05.  The values in the cells are calculated using the earlier formulas.



|             | COVID-19 Present | COVID-19 Absent | Sum     |
|-------------|------------------:|---------------:|---------:|
| RAT Positive | `r t_pos_01`     | `r f_pos_01`         | `r tot_pos_01`  |
| RAT Negative | `r f_neg_01`     | `r t_neg_01`          | `r tot_neg_01`  |
| Sum          | `r covid_cases_01` | `r covid_absent_01` | `r N_ct` |

: A 2 $\times$ 2 table for the COVID RAT test example with a hypothetical population size $N$ of 100,000 and COVID-19 prevalence 1% {#tbl-rat-complete-01} 

The PPV is now `r ppv_01`.  The reduced prevalence causes fewer true positive results, `r t_pos_01` versus `r t_pos_05`, and because of the larger number of individuals without the infection, an increased number of false positives, `r f_pos_01` versus `r f_pos_05`.  The ratio of true positives to total positives decreases.

The dependence of PPV on prevalence causes a conundrum in for screening populations for a rare disease -- there will be a large proportion of false positives.  That is especially important when a positive diagnostic test might be followed by a more invasive procedure.

```{r}
terms_chp_3 <- c(terms_chp_3, c("Bayes' rule",
                                "sensitivity",
                                "specificity",
                                "positive predictive value",
                                "PPV",
                                "negative predictive value",
                                "NPV",
                                "tree diagram")
                )
```

## Extended example: cat genetics {#sec-cat-genetics}

So far, the principles of probability have been illustrated with relatively short examples. In a more complex setting, it can be surprisingly difficult to translate a problem scenario into the language of probability. This section demonstrates how the rules of probability can be applied to work through a relatively sophisticated conditioning problem.

**Problem statement**

The gene that controls white coat color in cats, $KIT$, is responsible for multiple phenotypes such as deafness and blue eye color. A dominant allele $W$ at one location in the gene has complete **penetrance** \index{penetrance} for white coat color; all cats with the $W$ allele have white coats. There is incomplete penetrance for blue eyes and deafness; not all white cats will have blue eyes and not all white cats will be deaf. However, deafness and blue eye color are strongly linked, such that white cats with blue eyes are much more likely to be deaf. The variation in penetrance for eye color and deafness may be due to other genes as well as environmental factors.

Suppose that 30% of white cats have one blue eye, while 10% of white cats have two blue eyes. About 73% of white cats with two blue eyes are deaf and 40% of white cats with one blue eye are deaf. Only 19% of white cats with other eye colors are deaf.

a. Calculate the prevalence of deafness among white cats.
	
b. Given that a white cat is deaf, what is the probability that it has two blue eyes?
	
c.  Suppose that deaf, white cats have an increased chance of being blind, but that the prevalence of blindness differs according to eye color. While deaf, white cats with two blue eyes or two non-blue eyes have probability 0.20 of developing blindness, deaf and white cats with one blue eye have probability 0.40 of developing blindness. White cats that are not deaf have probability 0.10 of developing blindness, regardless of their eye color.
	
    i. What is the prevalence of blindness among deaf, white cats?
		
    ii. What is the prevalence of blindness among white cats?
		
    iii. Given that a cat is white and blind, what is the probability that it has two blue eyes?
    
```{r}
terms_chp_3 <- c(terms_chp_3, c("penetrance")
                )
```

	
**Establishing notation**

Before beginning any calculations, it is essential to clearly define any notation that will be used. For this problem, there are several events of interest: deafness, number of blue eyes (either 0, 1, or 2), and blindness. 

* Let $D$ represent the event that a white cat is deaf.

* Let $B_0$ = {zero blue eyes}, $B_1$ = {one blue eye}, and $B_2$ = {two blue eyes}.

* Let $L$ represent the event that a white cat is blind.


Since all cats mentioned in the problem are white, it is not necessary to define whiteness as an event; white cats represent the sample space.

**Part a, deafness**

The prevalence of deafness among white cats is the proportion of white cats that are deaf; i.e., the probability of deafness among white cats. This is the value of $P(D)$.

::: {.workedexample data-latex=""}

Using the notation above, rewrite the following information from the problem statement:

> Suppose that 30% of white cats have one blue eye, while 10% of white cats have two blue eyes. About 73% of white cats with two blue eyes are deaf and 40\% of white cats with one blue eye are deaf. Only 19% of white cats with other eye colors are deaf.


------------------------------------------------------------------------

The first sentence provides information about the prevalence of white cats with one blue eye and white cats with two blue eyes: $P(B_1) = 0.30$ and $P(B_2) = 0.10$. The only other possible eye color combination is zero blue eyes (i.e., two non-blue eyes); i.e., since $P(B_0) + P(B_1) + P(B_2) = 1$, $P(B_0) = 1  - P(B_1) - P(B_2) = 0.60$. Sixty percent of white cats have two non-blue eyes.

While it is not difficult to recognize that the second and third sentences provide information about deafness in relation to eye color, it can be easy to miss that these probabilities are conditional probabilities. A close reading should focus on the language: "About 73% *of* white cats with two blue eyes are deaf...": i.e., out of the white cats that have two blue eyes, 73% are deaf. Thus, these are probabilities of deafness conditioned on eye color. From these sentences, $P(D|B_2) = 0.73$, $P(D|B_1) = 0.40$, and $P(D|B_0) = 0.19$. 

:::

There are three possible ways to partition the event $D$ that a white cat is deaf: a cat could be deaf and have two blue eyes, be deaf and have one blue eye (and one non-blue eye), or be deaf and have two non-blue eyes. Thus, by the Addition Rule of Disjoint Events: 
$$
P(D) = P(D \text{ and } B_2 ) + P(D \text{ and } B_1 ) + P(D \text{ and } B_0 ).
$$

Although the joint probabilities of being deaf and having particular eye colors are not given in the problem, these can be calculated using the Multiplication Rule, @eq-mult-rule-two-probs:

\begin{align*}
P(D) =& P(D \text{ and } B_2 ) + P(D \text{ and } B_1 ) + P(D \text{ and } B_0 ) \\
=& P(D|B_2)P(B_2) + P(D|B_1)P(B_1) + P(D|B_0)P(B_0) \\
=& (0.73)(0.10) + (0.40)(0.30) + (0.19)(0.60) \\
=& 0.307.
\end{align*}

The prevalence of deafness among white cats is 0.307.

**Part b, deafness and eye color**

The probability that a white cat has two blue eyes, given that it is deaf, is $P(B_2|D)$: 

::: {.workedexample data-latex=""}

Using the definition of conditional probability, solve for $P(B_2|D)$. 

------------------------------------------------------------------------

$$
P(B_2|D) = \frac{P(D \text{ and } B_2)}{P(D)} = \frac{P(D|B_2)P(B_2)}{P(D)} = \dfrac{(0.73)(0.10)}{0.307} = 0.238. 
$$

The probability that a white cat has two blue eyes, given that it is deaf, is 0.238.

:::

The conditional probability $P(B_2 \mid D)$ uses the general version of  Bayes' Rule @eq-bayes-trad-gen,
using the three possible partitions of the event of deafness, $D$. In this problem, it is possible to directly substitute the value $P(D)$  calculated in part a. The expanded denominator in the expression below matches the earlier calculation of $P(D)$.
$$
P(B_2|D) = \dfrac{P(D \text{ and } B_2)}{P(D)} = \dfrac{P(D|B_2)P(B_2)}{P(D|B_2)P(B_2) + P(D|B_1)P(B_1) + P(D|B_0)P(B_0)}. 
$$

**Part c, blindness, deafness and eye color**

::: {.workedexample data-latex=""}

Reformulate the following from the problem statement into probability notation:

>Suppose that deaf, white cats have an increased chance of being blind, but that the prevalence of blindness differs according to eye color. While deaf, white cats with two blue eyes or two non-blue eyes have probability 0.20 of developing blindness, deaf and white cats with one blue eye have probability 0.40 of developing blindness. White cats that are not deaf have probability 0.10 of developing blindness, regardless of their eye color.

------------------------------------------------------------------------

The second sentence gives probabilities of blindness, conditional on eye color and being deaf: $P(L|B_2, D) = P(L|B_0, D) = 0.20$, and $P(L|B_1, D) = 0.40$. The third sentence gives the probability that a white cat is blind, given that it is not deaf: $P(L|D^C) = 0.10$.  

:::

Part i asks for the prevalence of blindness among deaf, white cats: $P(L|D)$. As in part a, the event of blindness given deafness can be partitioned by eye color:

$$
P(L|D) = P(L \text{ and } B_0|D) + P(L \text{ and } B_1 | D) + P(L \text{ and } B_2|D).
$${#eq-l-given-d}

::: {.workedexample data-latex=""}

Expand the @eq-l-given-d using the Multiplication Rule, @eq-mult-rule-two-probs.

------------------------------------------------------------------------

The general multiplication rule may seem difficult to apply when conditioning is present, but the principle remains the same. Think of the conditioning as a way to restrict the sample space; in this context, conditioning on deafness implies that for this part of the problem, all the cats being considered are deaf (and white). 
	
For instance, consider the first term, $P(L \text{ and } B_0|D)$, the probability of being blind and having two non-blue eyes, given deafness. How could this be rewritten if the probability were simply $P(L \text{ and } B_0)$? 
$$
P(L \text{ and } B_0) = P(L|B_0)P(B_0).
$$
Now, recall that for this part of the problem, the sample space is restricted to deaf (and white) cats. Thus, all of the terms in the expansion should include conditioning on deafness:
$$
P(L \text{ and } B_0|\textcolor{red}{D}) = P(L|\textcolor{red}{D}, B_0)P(B_0|\textcolor{red}{D}). 
$$
Thus, 
$$
P(L|D) = P(L|D, B_0)P(B_0|D) + P(L|D, B_1)P(B_1|D) + P(L|D, B_2)P(B_2|D).
$$

:::

Although $P(L|D, B_0)$, $P(L|D, B_1)$, and $P(L|D, B_2)$ are given in the problem statement, $P(B_0|D$, $P(B_1|D)$, and $P(B_2|D)$ are not. However, note that the probability that a white cat has two blue eyes given that it is deaf, $P(B_2|D)$, was calculated in part b. 

::: {.guidedpractice data-latex=""}

Calculate $P(B_0|D)$ and $P(B_1|D)$. [^probability-445]
:::

[^probability-445]: 
$$
P(B_0|D) = \frac{P(D \text{ and } B_0)}{P(D)} = \frac{P(D|B_0)P(B_0)}{P(D)} = \frac{(0.19)(0.60)}{0.307} = 0.371.
$$
$$
P(B_1|D) = \frac{P(D \text{ and } B_1)}{P(D)} = \frac{P(D|B_1)P(B_1)}{P(D)} = \frac{(0.40)(0.30)}{0.307} = 0.391.
$$

There is now enough information to calculate $P(L|D)$: 

\begin{align*}
P(L|D) =& P(L \text{ and } B_0|D) + P(L \text{ and } B_1 | D) + P(L \text{ and } B_2 |D) \\
=& P(L|D, B_0)P(B_0|D) + P(L|D, B_1)P(B_1|D) + P(L|D, B_2)P(B_2|D) \\
=& (0.20)(0.371) + (0.40)(0.391) + (0.20)(0.238) \\
=& 0.278.
\end{align*}

The prevalence of blindness among deaf, white cats is 0.278.

Part ii asks for the prevalence of blindness among white cats, $P(L)$. Again, partitioning is an effective strategy. Instead of partitioning by eye color, however, partition by deafness.

::: {.workedexample data-latex=""}

Calculate the prevalence of blindness among white cats, $P(L)$.

------------------------------------------------------------------------

\begin{align*}
P(L) =& P(L \text{ and } D) + P(L \text{ and } D^C) \\
=& P(L|D)P(D) + P(L|D^C)P(D^C) \\
=& (0.278)(0.307) + (0.10)(1 - 0.307) \\
=& 0.155.
\end{align*}	

$P(D)$ was calculated in part a), while $P(L|D)$ was calculated in part c, i. The conditional probability of blindness given a white cat is not deaf is 0.10, as given in the question statement. By the definition of the complement, $P(D^C) = 1 - P(D)$. 

The prevalence of blindness among white cats is 0.155.

:::

Part iii asks for the probability that a cat has two blue eyes, given that it is white and blind, $P(B_2|L)$. Since all cats being discussed in the problem are white, it is not necessary to condition on coat color.

Start out with the definition of conditional probability:
$$
P(B_2|L) = \dfrac{P(B_2 \text{ and } L)}{P(L)}. 
$$

The key to calculating $P(B_2|L)$ relies on recognizing that the event a cat is blind and has two blue eyes can be partitioned by whether or not the cat is also deaf:
$$
P(B_2|L) = \frac{P(B_2 \text{ and } L \text{ and } D) + P(B_2 \text{ and } L \text{ and } D^C)}{P(L)}.
$${#eq-pB2GivenL}

::: {.workedexample data-latex=""}

Draw a tree diagram to organize the events involved in this problem. Identify the branches that represent the possible paths for a white cat to both have two blue eyes and be blind. 

------------------------------------------------------------------------

When drawing a tree diagram, remember that each branch is conditioned on the previous branches. While there are various possible trees, the goal is to construct a tree for which as many of the branches as possible have known probabilities. 

The tree for this problem will have three branch points, corresponding to either deafness, blindness, or eye color. The first set of branches contain unconditional probabilities, the second set contains conditional probabilities given one event, and the third set contains conditional probabilities given two events.

Recall that the probabilities $P(L|D, B_0)$, $P(L|D, B_1)$, and $P(L|D, B_2)$ were provided in the problem statement. These are the only probabilities conditioned on two events that have previously appeared in the problem, so blindness is the most convenient choice of third branch point. 

It is not obvious whether it will be more efficient to start with deafness or eye color, since unconditional and conditional probabilities related to both have appeared in the problem. @fig-cat-genetics-trees shows two trees, figure (a) starting with deafness and (b) starting with eye color. The two possible paths for a white cat to both have two blue eyes and be blind are shown in green.

```{r}
#| label: fig-cat-genetics-trees
#| out-width: 80%
#| fig-cap: |
#|   Two tree diagrams for the cat genetics problem
#| fig-subcap: 
#|    - Tree beginning with first branch deafness
#|    - Tree beginning with first branch eye color
#| fig-alt: |
#|   draft alt caption here
#| fig-pos: H
#| layout-ncol: 2
knitr::include_graphics("images/catGeneticsTreesA.png")
knitr::include_graphics("images/catGeneticsTreesB.png")
```

:::

<!--- subfigure refs possible using markdown syntax for including figures.  Position of alt-text?

::: {#fig-example layout-ncol=2}

![Subfigure A caption.](fig-a.png){#fig-example-a}

![Subfigure B caption.](fig-b.png){#fig-example-b}

Main caption for the full figure.
:::

-->

::: {.workedexample data-latex=""}

Expand @eq-pB2GivenL according to the tree shown in @fig-cat-genetics-trees(a), and solve for $P(B_2|L)$.

------------------------------------------------------------------------

Two of the probabilities have not been calculated previously: $P(B_2|D^C)$ and $P(D^C)$. From the definition of the complement, $P(D^C) = 1 - P(D) = 0.693$; $P(D)$ was calculated in part a. To calculate $P(B_2|D^C)$, apply the definition of conditional probability as in part b, where $P(B_2|D)$ was calculated:
$$
P(B_2|D^C) = \dfrac{P(D^C \text{ and } B_2)}{P(D^C)} = \dfrac{P(D^C|B_2)(P(B_2)}{P(D^C)} = \dfrac{(1-0.73)(0.10)}{0.693} = 0.0390.
$$

\begin{align*}
P(B_2|L) &= \dfrac{(0.20)(0.238)(0.307) + (0.10)(0.0390)(0.693)}{0.155} \\
&= 0.112
\end{align*}
	
The probability that a white cat has two blue eyes, given that it is blind, is 0.112.

:::

::: {.guidedpractice data-latex=""}

Expand @eq-pB2GivenL} according to the tree shown in @fig-cat-genetics-trees(b), and solve for $P(B_2|L)$.  [^probability-446]
:::

[^probability-446]: 
\begin{align*}
P(B_2|L) &= \frac{P(L|B_2, D)P(D|B_2)P(B_2) + P(L|B_2, D^C)P(D^C|B_2)P(B_2)}{P(L)} \\             &=\frac{(0.20)(0.73)(0.10) + (0.10)(1-0.73)(0.10)}{0.155} \\
         &= 0.112.
\end{align*}

A tree diagram is useful for visualizing the different possible ways that a certain set of outcomes can occur. Although conditional probabilities can certainly be calculated without the help of tree diagrams, it is often easy to make errors with a strictly algebraic approach. Once a tree is constructed, it can be used to solve for several probabilities of interest. The following example shows how one of the previous trees can be applied to answer a different question than the one posed in part c, iii.

::: {.workedexample data-latex=""}

What is the probability that a white cat has one blue eye and one non-blue eye, given that it is not blind?

------------------------------------------------------------------------

Calculate $P(B_1|L^C)$. Start with the definition of conditional probability, then expand.

\begin{align*}
    P(B_1|L^C) &= \frac{P(B_1 \text{ and } L^C)}{P(L^C)} \\
    &= \frac{P(B_1 \text{ and } L^C \text{ and } D) + P(B_1 \text{ and } L^C \text{ and } D^C)}{P(L^C)}.
\end{align*}


@fig-cat-genetics-trees-c is a reproduction of the earlier @fig-cat-genetics-trees(b), with yellow arrows showing the two paths of interest.

As before, expand the numerator and fill in the known values.
	
\begin{align*}
	P(B_1|L^C) =& \frac{P(B_1 \text{ and } L^C \text{ and } D) + P(B_1 \text{ and } L^C \text{ and } D^C)}{P(L^C)}\\
	=& \frac{P(L^C|D, B_1)P(D|B_1)P(B_1) + P(L^C|D^C, B_1)P(D^C|B_1)P(B_1)}{P(L^C)} \\
	=& \frac{\textcolor{red}{\mathbf{P(L^C|D, B_1)}}(0.40)(0.30) + \textcolor{red}{\mathbf{P(L^C|D^C, B_1)P(D^C|B_1)}}(0.30)}{\textcolor{red}{\mathbf{P(L^C)}}}.
	\end{align*} 
	
The probabilities in [**red**]{style="color:red"} are not known. Apply the definition of the complement; recall that the rule for complements holds when an event and its complement are conditioned on the same information: $P(A|B) = 1 - P(A^C|B)$.
	
* $P(L^C) = 1 - P(L) = 1 - 0.155 = 0.845$
* $P(D^C|B_1) = 1 - P(D|B_1) = 1 - 0.40 = 0.60$
* $P(L^C|D, B_1) = 1 - P(L|D, B_1) = 1 - 0.40 = 0.60$

	
	The definition of the complement can also be applied to calculate $P(L^C|D^C, B_1)$. The problem statement originally specified that white cats that are not deaf have probability 0.10 of developing blindness regardless of eye color: $P(L|D^C) = 0.10$. Thus, $P(L^C|D^C, B_1) = P(L^C|D^C)$. By the definition of the complement, $P(L^C|D^C) = 1 - P(L|D^C) = 1 - 0.10 = 0.90$.
	
\begin{align*}
	P(B_1|L^C) =& \frac{P(B_1 \text{ and } L^C \text{ and } D) + P(B_1 \text{ and } L^C \text{ and } D^C)}{P(L^C)}\\
	=& \frac{P(L^C|D, B_1)P(D|B_1)P(B_1) + P(L^C|D^C, B_1)P(D^C|B_1)P(B_1)}{P(L^C)} \\
	=& \frac{(0.60)(0.40)(0.30) + (0.90)(0.60)(0.30)}{0.845} \\
	=& 0.277.
\end{align*} 
	
The probability that a white cat has one blue eye and one non-blue eye, given that it is not blind, is 0.277.

```{r fig-cat-genetics-c}
#| label: fig-cat-genetics-trees-c
#| out-width: 80%
#| fig-cap: |
#|   The two possible paths for a white cat to both have one blue eye (and one non-blue eye) and to not be blind are shown in yellow.
#| fig-alt: |
#|   draft alt caption here
#| fig-pos: H
#| layout-ncol: 1
knitr::include_graphics("images/catGeneticsTreesC.png")

```


:::

## Chapter review {#sec-chp3-review}

### Summary

Chapter summary here


```{r}
#| label: tbl-terms-chp-3
#| tbl-cap: Terms introduced in this chapter.
#| tbl-pos: H
make_terms_table(terms_chp_3)
```

\clearpage

## Exercises {#sec-chp3-exercises}

