# Introduction to data {#sec-intro-to-data}

```{r}
#| include: false
source("_common.R")
```

::: {.chapterintro data-latex=""}
Making observations and recording data are essential to empirical research and often begin a systematic approach to investigating scientific questions. The discipline of statistics focuses on addressing the following three questions: How should data be organized, summarized and explored? How can data best be collected? What can be learned from data?

This chapter provides an introduction methods for summarizing and exploring data.
:::

```{r}
#| include: false
terms_chp_1 <- c("data")
```

## Case study: Preventing peanut allergies {#sec-case-study-preventing-peanut-allergies}

\index{data!LEAP|(}


The proportion of young children in Western countries with peanut allergies has doubled in the last 10 years and some studies have suggested that exposing infants to peanut-based foods, rather than excluding such foods from their diets, may be an effective strategy for preventing peanut allergies (see @du2008early). The "Learning Early about Peanut Allergy" (LEAP, @du2015randomized) study was conducted in a controlled setting to investigate whether early exposure to peanut products reduces the probability that a child will develop a peanut allergy.

The study team enrolled children in the United Kingdom between 2006 and 2009, selecting 640 infants between 4 and 11 months old with eczema, an egg allergy, or both. Each child was randomly assigned to either the peanut consumption (treatment) group or the peanut avoidance (control) group. Children in the treatment group were fed at least 6 grams of peanut protein daily until 5 years of age, while children in the control group avoided peanut protein until 5 years of age.

At age 5, each child was tested for a peanut allergy using an oral food challenge (OFC): 5 grams of peanut protein in a single dose. If a child showed no allergic reaction the intervention (treatment or control) received by the child, the outcome was recorded as a PASS; if the intervention received by the child failed to prevent an allergic reaction, the outcome was recorded as a FAIL. The main analysis presented in the paper was based on data from 530 children with a negative skin test at study entry. Although a total of 542 children had an earlier negative skin test, data collection did not occur for 12 children.

Individual-level data from the study are shown in @tbl-leapStudyResultsDF, which shows 5 children in a dataset restricted to children with a negative skin prick test for a peanut allergy at the time of randomization. Each row represents a participant and shows the `participant.ID` (an anonymous participant identifier), `treatment.group` (the treatment randomly assigned) and `overall.V60.outcome` (result of the OFC at 60 months of age). The LEAP data can be found in the [**openintro**](http://openintrostat.github.io/openintro) R package.

```{r}
#| label:  tbl-leapStudyResultsDF
#| tbl-cap:  "Five patients from the LEAP study"
#| tbl-pos: H

LEAP_trimmed <- LEAP |> 
    dplyr::select(
      participant.ID, 
      treatment.group, 
      overall.V60.outcome) |> 
    slice(1:3, 529, 539)

LEAP_trimmed  |> 
  kbl(linesep = "", booktabs = TRUE, align = "lll")|>
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    latex_options = c("striped"),
    full_width = FALSE)
```

The data can be organized in a two-way summary table; table @tbl-leapStudyResults shows the results grouped by treatment group and OFC outcome.

```{r}
#| label:  tbl-leapStudyResults
#| tbl-cap:  "Results from the LEAP study"
#| tbl-pos: H
options(knitr.kable.NA = '')

LEAP_analyzed <- LEAP |> 
  dplyr::filter(stratum == "SPT-Negative") |> 
  dplyr::filter(!is.na(overall.V60.outcome))

LEAP_analyzed |> 
  count(overall.V60.outcome, treatment.group) |> 
  group_by(treatment.group) |> 
  pivot_wider(names_from = overall.V60.outcome, 
              values_from = n) |> 
  relocate(`FAIL OFC`, .after = `PASS OFC`) |>
  mutate(`Proportion failing` = `FAIL OFC`/(`PASS OFC` + `FAIL OFC`)) |>
  adorn_totals(where = c("row", "col")) |> 
  kbl(linesep = "", booktabs = TRUE) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    latex_options = c("striped")
  )
```

The summary table makes it easy to identify patterns in the data. In the two groups combined, the intervention failed to prevent an allergy in $15.6\%$ of the children, but the proportions of failures the proportion of failures in the two groups are different. In the avoidance group, the proportion of OFC failures is $36/263 = 0.137$ ($13.7\%$); in the consumption group, it is $5/267 = 0.019$ ($1.9\%$).

The difference in the proportions of OFC failures between the two groups is $11.8\%$; nearly $12\%$ more of the participants in the avoidance group tested positive in the avoidance versus than consumption groups. The data can also be summarized by the ratio the two proportions ($0.137/0.019 = 7.31$); the rate of a subsequent allergy the avoidance group is more than 7 times larger than in the consumption group; i.e., the risk of failing the a subsequent peanut allergy was more than 7 times greater in the avoidance group relative to the consumption group.

Even without sophisticated methods of analysis, the results of the study are striking. Early exposure to peanut products may be an effective strategy for reducing the chances of developing peanut allergies later in life. But are these results definitive? In other words, is the $11.8\%$ difference between the two groups larger than one would expect by chance variation alone? The methods of inference in later chapters will provide the statistical tools to answer this question.

In the language of medical research, LEAP was a clinical trial -- a study done to improved the understanding of an intervention in a clinical setting. In statistical terms, LEAP was an experiment involving human subjects -- a study done in a controlled setting to estimate the difference in outcome using two interventions to prevent peanut allergies. Experiments will be explored in more detail later in the text in Section @sec-experiments of Chapter @sec-collecting-data.

The study illustrates some of the issues in research in \index{evidence-based medicine}, some explicit and some implicit, that are discussed in later chapters. The study was done when a common approach to preventing peanut allergies among susceptible children was based on avoiding peanut products. LEAP was an important step in overcoming that notion by providing evidence that the previous approach of avoiding peanut products was not the best approach, no matter how natural it may have seemed. The parents of the infants participating in the study consented to allow their children to be randomly assigned to one of two interventions with uncertain value. Investigators conducting this and similar studies are ethically bound to ensure that the study is supported by prior data, that the study has a sound design, and is conducted responsibly.

\index{data!LEAP|)}

## Organizing and classifying data {#sec-data-organization}

\index{data!crabs|(}

When spawning, a female horseshoe crab migrates to shore with a male attached to her spine to lay clusters of eggs in the sand. Additional male crabs may join the pair and fertilize the eggs as well, presumably increasing genetic diversity of the offspring. The additional male crabs are called satellites. The dataset `crabs` examined here contains observations on $173$ female crabs, with $5$ recorded measurements for each crab, so the data matrix consists of $173$ rows and $5$ columns. The data originally appeared in Brockman [@brockmann1996satellite] and can be found at the website for *Categorical Data Analysis, 3rd ed.*[@agresti2013categorical] and in the R package `asbio`. The dataset is used later in Chapter @sec-logistic-regression to explore the relationship between the features of a female crab and the number of satellites it attracts.

Table @tbl-crabsDF shows data from $6$ randomly selected crabs from the $173$ observed in the study.  Each row in the table corresponds to a single crab, indicating the color of the carapace (the shell carried by the crab on its back),  the condtion of the two spines along the edge of its abdomen, the width of the carpace, the number of male satellites the crab has attracted and the weight of the crab.  Each crab is a **case**, sometimes called a **unit of observation** or an \index{observational unit} **observational unit**. When observations are made on people participating in a study, as in LEAP, the observational units are called \index{human subjects} **human subjects** or **participants**. The recorded characteristics are referred to as \index{variables} **variables**; in Table @tbl-crabsDF, each row represents a case or an observational unit (a cluctch) and each column a variable. The entries in a row are the values of the variables for that case.   Because the observations in the data are organized into rows and columns, the dataset is sometimes called a \index{data table} **data table** or a \term{data matrix} **data matrix**.

Data matrices are a convenient way to record and store data. If data are collected for another observational unit, a row can easily be added; similarly, another column can be added for a new variable. The \index{distribution} **distribution** of a variable is its collection of values. The distribution of the variable `weight`, for instance, is the set of values in the column of the `crabs` data matrix with the label `weight.`



```{r}
#| label:  tbl-crabsDF
#| tbl-cap:  "Six observations from the crabs dataset"
#| tbl-pos: H

library(asbio)
data(crabs)
set.seed(080548)
crabs_df <-  crabs |> 
  mutate(color = fct_recode(color,
    "light medium" = "1",
    "medium" = "2",
    "dark medium" = "3",
    "dark" = "4")) |> 
  mutate(spine = fct_recode(spine,
     "both good" = "1",
     "one worn or broken" = "2",
     "both worn or broken" = "3" )) |> 
  sample_n(6)

crabs_df |> 
  kbl(linesep = "", booktabs = TRUE, align = "ccrr")|>
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    latex_options = c("striped"),
    full_width = FALSE)
```


Table @tbl-crabsVarDescriptions contains the descriptions of the variables. It is important to check the definitions of variables, as they are not always obvious.  In the `crabs` data, the definitions specify that the measurements of `width` and `weight` are in metric units and the `spine` records the condition of the two spines near the abdomen of each crab.



```{r}
#| label:  tbl-crabsVarDescriptions
#| tbl-cap:  "Variable definitions for horseshoe crab data"
#| tbl-pos: H

crabs_var_name <- c("color",
                     "spine",
                     "width",
                     "satell",
                     "weight")
crabs_var_description <- c("color of the carapace",
                            "condition of the spines along the edge of the abdomen",
                            "width of the carapace in cm",
                            "number of male satellites",
                            "weight in kg")
crabs_var_table  <- data.frame(crabs_var_name, crabs_var_description)
crabs_var_table  <- crabs_var_table  |> 
          rename('Variable name' = crabs_var_name,
                  'Variable description' = crabs_var_description)

crabs_var_table  |> 
  kbl(linesep = "", booktabs = TRUE, align = "cl")|>
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    latex_options = c("striped"),
    full_width = FALSE)
```




Datasets are collected to learn about the \index{population} **population** from which the observational units were selected. The `crabs` data were collected to learn about the features of female crabs that made them more attractive to males.  The `crabs` data were gathered in an observational study; the principles and interpretation of observational studies are discussed in Section @sec-observational-studies of Chapter @sec-collecting-data.

```{r}
terms_chp_1 <- c(terms_chp_1, "data matrix")
```




A variable is classified according the types of calculations the variable supports. The variables `width` and `weight` are \index{numerical variables} **numerical variables**, also called quantitative variables. They take on values that can be added, subtracted, or averaged. The two variables `width` and `weight` are \index{numerical variable!continuous} **continuous numerical variables** because they can take on all values within a specified range. The number of male satellites (`satell`) is a \index{numerical variable!discrete} **discrete numerical variable**, a variable that can take on one of a set of values, in this case an integer between 0 and the largest number of satellites who can attach to a female horseshoe crab.

The variables `color` and `spine` are \index{categorical variables} **categorical variables**, also called qualitative variables. The values of categorical variables are names or labels; in this case the values are carapace colors or the condition of the spines of the crab. Arithmetic operations cannot be performed on categorical variables, but they can be tabulated. When the labels of a categorical variable have no natural ordering, the variable is a **nominal categorical variable**. `Spine` is an **ordered categorical variable** since its categories indicate worsening conditions of the spines. Categorical variables are also called \index{factor variable} factor variables in R.

\index{data!crabs|)}

```{r}
terms_chp_1 <- c(terms_chp_1, "numerical variable", "categorical variable")
```

Other types of variables arise in some applications that require specialized software to manipulate and are not discussed in this text. Character or string variables are sometimes used to record an open ended response to a question on a survey. Dates are often coded so that they can be manipulated with operations that extract the year or day of the week of a date.  Image data are used to record the result of a photograph or other imaging procedure, such as a magnetic resonance imaging (MRI) scan of an organ or region of the body.

Figure @fig-variable-types shows the types of variables used in this text.

```{r}
#| label: fig-variable-types
#| out-width: 80%
#| fig-cap: Breakdown of variables into their respective types
#| fig-pos: H

knitr::include_graphics("images/variableTypes.png")

```


::: {.workedexample data-latex=""}
In addition to the treatment and outcome variables shown in Table @tbl-leapStudyResultsDF,  the study team collected the age in months and sex of each participant and the results of the initial skin test for peanut allergies (negative or positive.)  Classify these variables, `treatment.group` and `overall.V60.outcome`. Answers to guided practice problems are provided in the footnotes. [^intro-to-data-1]

------------------------------------------------------------------------
 The variables `treatment.group`, `overall.v60.outcome`, sex (male or female) and the result of the skin test all measure non-numerical quantities, and thus are categorical variables, each with two levels.  Age is a continuous variable.

:::

::: {.guidedpractice data-latex=""}
Answers to guided practice problems are provided in the footnotes.[^intro-to-data-1]   Suppose that on a given day, a research assistant collected data on the first 20 individuals visiting a walk-in clinic: `age` (measured as less than 21, 21 - 65, and greater than 65 years of age), `gender`, `height`, `weight`, and `reason for the visit`.  Classify each of the variables. (Note: answers to Guided Practice exercises are provided in footnotes)[^01-data-hello-1]
:::

[^01-intro-to-data-1]: `Height` and `weight` are continuous numerical variables. Age as measured by the research assistant is `ordinal categorical`. `Sex` and `the reason for the visit` are nominal categorical variables.

## Summarizing and visualizing data {#sec-summarizing-visualizing-data}

### Categorical data {#sec-summarizing-categorical-data}

Categorical data are summarized in tables, such as @tbl-crabs-colors-frequency showing the number of each color in the carapace of the 173 crabs in the `crabs` data.

```{r}
#| label: tbl-crabs-colors-frequency
#| tbl-cap:  "Distribution of colors of the 173 crabs in the crabs dataset.  The Count column
#|    indicates the number of each color."
#| tbl-pos: H
crabs |> 
  mutate(color = fct_recode(color,
    "light medium" = "1",
    "medium" = "2",
    "dark medium" = "3",
    "dark" = "4")) |> 
  count(color) |>
  rename(Color = color) |> 
  rename(Count = n)  |> 
  adorn_totals(where = "row") |>
  kbl(linesep = "", booktabs = TRUE) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    latex_options = c("striped"),
    full_width = FALSE
  )
  

```

Table @tbl-crabs-colors-frequency is a \index{frequency table} **frequency table** showing the number of crabs of each color in the column labeled Count. When the proportion of crabs with each color is added to the table it is called a \index{relative frequency table} **relative frequency table**, as shown in Table @tbl-crabs-colors-relative-frequency.

```{r}
#| label: tbl-crabs-colors-relative-frequency
#| tbl-cap:  "Distribution of colors of the 173 crabs in the crabs dataset"
#| tbl-pos: H

crabs |> 
  mutate(color = fct_recode(color,
    "light medium" = "1",
    "medium" = "2",
    "dark medium" = "3",
    "dark" = "4")) |> 
  count(color) |>
  mutate("Proportion" = n/sum(n)) |>
  rename(Count = n) |>
  rename(Color = color) |> 
  adorn_totals(where = "row") |>
  kbl(linesep = "", booktabs = TRUE) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    latex_options = c("striped"),
    full_width = FALSE
  )
  
```

Frequency and relative frequency tables are used with nominal categorical variables, where the labels have no natural ordering. With ordered categorical variables it is useful to add a column of cumulative proportions showing the fraction of cases up and including each label in the natural ordering of the variable.

Table @tbl-crabs-spine-cumulative-frequency shows the counts, proportions and cumulative proportions for the spine condition of the crabs. Spine injuries are common in this group.  Only $21\%$ of the crabs have no worn or broken spines; $30\%$ have no more than one damages spine.

Table @tbl-leapStudyResults is both a frequency and relative frequency table for LEAP, and shows the counts of the two possible responses to the oral challenge by intervention, along with the proportion of the oral challenge failures by intervention.

```{r}
#| label: tbl-crabs-spine-cumulative-frequency
#| tbl-cap:  "Counts, proportions and cumulative proportions of the altitude of study
#|    sites in the `crabs` dataset."
#| fig-alt: "Frequencies, proportions and cumulative proportions of spine condition
#|    sites in the `crabs` dataset."
#| tbl-pos: H
source("_common.R")

crabs_df <-  crabs |> 
  mutate(color = fct_recode(color,
    "light medium" = "1",
    "medium" = "2",
    "dark medium" = "3",
    "dark" = "4")) |> 
  mutate(spine = fct_recode(spine,
     "both good" = "1",
     "one worn or broken" = "2",
     "both worn or broken" = "3" ))

crabs_df |> 
  count(spine) |> 
  mutate(`Proportion` = n/sum(n)) |>
  mutate(`Cumulative proportion` = cumsum(`Proportion`)) |> 
  rename(Count = n) |> 
  rename(`Spine condition` = spine) |> 
  kbl(linesep = "", booktabs = TRUE) |> 
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    latex_options = c("striped"),
    full_width = FALSE
  )

```

\index{bar plot} The **bar plots** in Figure @fig-crabs-counts-proportions provide a visual display of the information in Table @tbl-crabs-colors-relative-frequency. Since proportions are the counts divided the total sample size, the two figures have the same shape; a bar plot with proportions is a rescaling of the plot with counts.

More interesting bar plots are used to display the relationship between two categorical variables and are discussed in Section @sec-relationships-in-data.

```{r}
#| label: fig-crabs-counts-proportions
#| fig-cap: Distribution of crab carapace colors.
#| fig-subcap:
#|   - Counts of color.
#|   - Proportions of color.
#| fig-alt: |
#|   Counts and proportions of the values of the color of the crabs.  Light medium
#|   is the most common color. 
#| fig-width: 4
#| layout-ncol: 2
library(asbio)
data(crabs)
crabs_color <-  crabs |> 
  mutate(color = fct_recode(color,
    "light medium" = "1",
    "medium" = "2",
    "dark medium" = "3",
    "dark" = "4")) 

ggplot(crabs_color, aes(x = color)) +
  geom_bar(fill = IMSCOL["green", "full"]) +
  labs(x = "Crab color", y = "Count")

crabs_color |>
  count(color) |>
  mutate(proportion = n / sum(n)) |>
  ggplot(aes(x = color, y = proportion)) +
  geom_col(fill = IMSCOL["green", "full"]) +
  labs(x = "Crab color", y = "Proportion")
```

<!-- add a stacked bar chart here -->


### Numerical data {#sec-summarizing-numerical-data}

A numerical variables usually summarized by the center and spread of its distribution. This section uses `clutch.volume` in the `frog` data to discuss numerical summaries, also called \index{summary statistics} **summary statistics**. Section @sec-relationships-in-data will explore the relationships between `altitude` and `clutch.volume`, along with an unexpected relationship of `body.size` with these two variables.

The \index{mean} **mean**, sometimes called the \indexthis{average}{mean!average}, is a measure of center of a distribution and is denoted (generically) by $\overline{x}$. The average clutch volume in the `frog` data is calculated by summing all the volumes and dividing by the total number of clutches, as illustrated below. For computational convenience, the volumes have been rounded to the first decimal digit (the nearest tenth of a volume).

```{=tex}
\begin{align*}
\overline{x} =& \frac{177.8 + 257.0 + \cdots + 933.3}{431} = 882.5\ \textrm{mm}^{3}.
\end{align*}
```
Since data are almost always a sample from a population, $\overline{x}$ is usually referred to as a \index{sample mean} **sample mean**. The \index{population mean} **population mean** of the population from which the sample was selected is denoted by the Greek letter $\mu$.  In the `frog` data, $\mu$ would be the mean clutch volume for all clutches in the region studied.

::: {.important data-latex=""}
**Mean.**

The mean of a variable is the sum of the observed values divided by the number of observations:

\vspace{-5mm}

$$ \bar{x} = \frac{x_1 + x_2 + \cdots + x_n}{n} $$
:::

The \index{median} **median** is another measure of center; it is the middle value of a distribution after the values have been ordered from smallest to largest. The median divides the distribution into two parts; half of the values are less than the median and half are larger. The middle value is well-defined if there are an odd number of observations; it will have the same number of observations below and above it. If the distribution contains an even number of observations, the median is the average of two middle observations. There are $431$ clutch volumes in the dataset; the $216^{th}$ observation, $831.8\ \textrm{mm}^{3}$, has $215$ observations below and above it when the values are ordered.

::: {.important data-latex=""}
**Median: the number in the middle.**

If the data are ordered from smallest to largest, the **median** is the middle observation. If there are an even number of observations, the median is the average of the two middle observations
:::

The \index{standard deviation} **standard deviation** and \index{interquartile range} **interquartile range** are two common measures of spread.

The standard deviation describes the typical distance between an observation and the mean. The distance of a single observation from the mean is its \index{deviation} **deviation**. The deviations for the $1^{st}$, $2^{nd}$, $3^{rd}$, and $431^{st}$ observations in `clutch.volume` are: 
\begin{align*}
x_1-\overline{x} &= 177.8 - 882.5 = -704.7 \hspace{5mm}\text{ } \\
x_2-\overline{x} &= 257.0 - 882.5 = -625.5 \\
x_3-\overline{x} &= 151.4 - 882.5 = -731.1 \\
&\ \vdots \\
x_{431}-\overline{x} &= 933.2 - 882.5 = 50.7
\end{align*} The units for these $4$ values are mm$^3$.

```{=html}
<!--

library(oibiostat)
library(dplyr)

x <- frog$clutch.volume
x_bar <- round(mean(x), 1)
x_bar


sel_values <- c(first(x),
              nth(x,2),
              nth(x,3),
              last(x))

dev <- sel_values - x_bar
dev_sq <- dev^2

var(x)
sd(x)

-->
```
The \index{variance} **variance** of a distribution (also called the **sample variance**) is the average of the squares of these deviations, and is denoted by $s^2$. For the clutch volumes

```{=tex}
\begin{align*}
s^2 &= \frac{(-704.7)^2 + (-625.5)^2 + (-731.1)^2 + \cdots + (50.7)^2}{431-1} \\
&= \frac{496,602.09 + 391,250.25 + 534,507.21 + \cdots + 2570.49}{430} \\
&= 143,680.9.
\end{align*}
```
The denominator of the variance is $n-1$ rather than $n$ for reasons that will be explained later. The units of the variance are the square of the units of the original measurements, in this case mm$^3$-squared.

The \index{standard deviation} **standard deviation** $s$ is the square root of the variance: 
$$
s=\sqrt{143,680.9} = 379.05 \textrm{mm}^{3}.
$$ 
The \index{population standard deviation} **population standard deviation** of the population from which the sample was selected is denoted by the Greek letter $\sigma$. The units of the standard deviation are the original scale of measurement.

::: {.important data-latex=""}
**Standard deviation.**

The sample standard deviation is the square root of the sum of the squared distance of each value from the mean divided by the number of observations minus one:

\vspace{-5mm}

$$s = \sqrt{\frac{\sum_{i=1}^n (x_i - \bar{x})^2}{n-1}}$$
:::

The \index{interquartile range} **interquartile range**, or \index{IQR} **IQR** is the width of the middle 50% of the data. It is the difference between the third and first quartiles: $Q_3 - Q_1$. The first quartile ($Q_1$) is also called the $25^{th}$ percentile; i.e., 25% of the data fall below this value. The third quartile ($Q_3$) is the $75^{th}$ percentile. The first quartile is the median of the half of the data below the overall median; $Q_3$ is the median of the upper half of the data. The median is sometimes denoted as $Q_2$, since it marks the second quartile (the $50^{th}$ percentile). The three values $Q_1$, $Q_2$ and $Q_3$ divide the data into 4 chunks, each with approximately 25% of the observations.



::: {.important data-latex=""}
**Interquartile range (IQR).**

The interquartile range (IQR) is $Q_3 - Q_1,$ where $Q_1$ and $Q_3$ are the $25^{th}$ and $75^{th}$ percentiles of a distribution. It measures the spread of the central 50% of a distribution.

An $\alpha$ **percentile**\index{percentile} is a number with $\alpha$% of the observations below it and $100-\alpha$% of the observations above it. For example, the $90^{th}$ percentile `clutch.volume` is the value with 90% of the clutches below and 10% above that value.
:::

The \index{five number summary} **five number summary** is a compact numerical summary providing the largest and smallest observations, the first and third quartiles, and the median. Table @tbl-five-num-summ-clutch-volume shows the five number summary for `clutch.volume`.

```{r}
#| label: tbl-five-num-summ-clutch-volume
#| tbl-cap: |
#|   The five number summary for clutch volume in the `frog` data.
#| tbl-pos: H
summ_stat_clutch.volume <- frog |> 
  summarize(
    Minimum = min(clutch.volume),
    `First Quartile (Q1)` = quantile(clutch.volume, probs = 0.25),
    Median = median(clutch.volume),
    `Third Quantile (Q3)` = quantile(clutch.volume, probs = 0.75),
    Maximum = max(clutch.volume)
  ) 

summ_stat_clutch.volume |> 
  mutate(across(where(is.numeric), ~ num(., digits = 1))) |> 
  kbl(linesep = "", 
      booktabs = TRUE, 
      align = "rrrrr")  |>
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    latex_options = c("striped")
  )

```

The clutch volumes range in size from approximately $150$mm$^3$ to $2630$mm$^3$.  The median $831.8$mm$^3$ splits the data in half. Approximately $50\%$ of the observations are between the first and third quartiles, $610$mm$^3$ and $1097$mm$^3$. The mean $883$mm$^3$ is considerably larger than the median. Figure @fig-clutch-volume-dotplot shows why.  

The dot plot in Figure @fig-clutch-volume-dotplot divides the horizontal axis from $0$ to $2800$ into intervals or bins of width $20$mm$^3$, $(0, 20], (20, 40], \ldots, (2780, 2800]$.  The number of dots above each bin corresponds to the number of clutch volumes falling in that bin.  In addition to the expected clustering of observations between $Q_1$ and $Q_3$, the plot shows $11$ values uncharacteristically larger than the rest, all larger than $1575$mm$^3$; four of these are larger than $2000$mm$^3$. Arithmetic averages are sensitive to either extremely large or small observations. This is easily seen in the small dataset $2,4,6,8,10$, where the mean and median are both $6$. When the largest value $10$ is replaced by $30$, the median is unchanged but the mean increases to $10$. In the `frog` data the 11 large clutch volumes have shifted the mean to the right of the median.


```{r}
#| label: fig-clutch-volume-dotplot
#| fig-cap: Dot plot showing the distribution of clutch volumes in the `frog` data
#| 
#| fig-alt: |
#|   Dot plot plot showing the distribution of clutch volumes.  The large values 
#|   at the right edge of the plot cause the mean to be larger than the median.
#| fig-asp: 0.4

ggplot(frog, aes(x = clutch.volume)) +
  geom_dotplot(binwidth = 20, 
  dotsize = 1.0, 
  method = "histodot",
  drop = FALSE) +
  labs(x = NULL, y = NULL) +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank()
  ) +
  scale_x_continuous(
    breaks = seq(0, 2800, 500)) +
  labs(x = "Clutch volume") 

```





```{=html}
<!--

x <- c(2, 4, 6, 8, 10)
mean(x)
sd(x)
y <- c(2,4,6,8,30)
mean(y)
sd(y)

-->
```

The median is a \index{robust statistic} **robust statistic**, a summary statistic that is minimally affected by a few extreme observations. It is a robust measure of the center of a distribution. For the same reason, the IQR is a robust measure of spread of a distribution. When $10$ is replaced by $30$ in the small dataset of 5 numbers, the standard deviation increases from $3.16$ to $11.40$, while the IQR ($8 - 4 = 4$) is unchanged.

When the mean of a variable is much larger or smaller than the median, it is important inspect the data for unusually large or small observations to be sure they are not the result of measurement or recording errors. The five number summary of `clutch.volumes` suggests there are large observation distant from the mean, and Figure @fig-clutch-volume-dotplot shows those values. Numerical summary statistics should be paired with visual displays whenever possible.

\index{box plot} **Box plots** provide a visual display of the robust measures of the location and spread of a distribution as well as the values that might influence the less robust mean and standard deviation, and is constructed from a five number summary.  Figure @fig-clutch-volume-dotplot-boxplot shows the dot plot in Figure @fig-clutch-volume-dotplot and a box plot below it.  

In a box plot, the interquartile range is represented by a rectangle extending from the first to the third quartile, and the rectangle is split by the median (second quartile). The lines extending from first and third quartiles (sometimes called whiskers) reach toward $Q_1 - 1.5\times \textrm{IQR}$ and $Q_3 + 1.5\times \textrm{IQR}$. The whiskers always end at observed data points, so the values given by adding or subtracting $1.5\times IQR$ define the maximum reach of the whiskers. With `clutch.volume`, $Q_3 + 1.5 \times \textrm{IQR} = 1,096.5 + 1.5\times 486.4 = 1,826.1 \textrm {mm}^{3}$. Since there was no clutch with volume $1,826.1$ mm$^3$, so the upper whisker extends to $1,819.7$mm $^3$  the largest observation  smaller than $Q_3 + 1.5\times \textrm{IQR}$.

Any observation that lies beyond the whiskers is shown with a dot; these observations are called outliers. An \index{outlier} **outlier** is a value that appears extreme relative to the rest of the data. There are several large outliers and no small outliers in `clutch.volume` indicating the presence of the unusually large egg clutches discussed earlier.


The dot and box plots in Figure @fig-clutch-volume-dotplot-boxplot provide different views of distribution of `clutch.volume`.  The dot plot shows a large cluster of observations just below the median, a spike that is not matched elsewhere in the data.  There are some intriguing gaps in the distribution, some bins with no observations.

The box plot hides those details in favor of showing the essential information about center and spread in a graphic that is perhaps easier to process.  The two graphs might be compared to the difference between reading a novel versus a one page review.


```{r}
#| label: fig-clutch-volume-dotplot-boxplot
#| fig-cap: Distribution of clutch volumes from the `frog' dataset.
#| fig-subcap:
#|   - Dot plot
#|   - Box plot
#| fig-alt: |
#|   Two plots showing the same variable, clutch.volume. The upper image is a 
#|   dot plot, the lower is a box plot. 
#| fig-asp: 0.3
#| 

ggplot(frog, aes(x = clutch.volume)) +
  geom_dotplot(binwidth = 20,
  dotsize = 1, 
  method = "histodot",
  drop = FALSE) +
  labs(x = NULL, y = NULL) +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank()
  ) +
  scale_x_continuous(
    breaks = seq(0, 2800, 500)) 

ggplot(frog, aes(x = clutch.volume)) +
  geom_boxplot(outlier.size = 2.5) +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank()
  ) +
  labs(x = "Clutch volume") +
  scale_x_continuous(
    breaks = seq(0, 2800, 500)
  )

```

A \index{histogram} **histogram**  provides a balance between the fine detail of a dot plot and the compact summary of a box plot.  In a histogram, observations are grouped into bins and the height of a bar above each bin is the number of observations in the bin.  Figure~\ref{frogBinnedClutchVolTable} shows the number of clutches with volumes in the intervals $(0,200]$mm$^3$, $(200, 400]$mm$^3$, $\ldots,  (2,600, 2,800]$mm$^3$.^[By default in R, the bins are left-open and right-closed; i.e., the intervals are of the form $(a, b]$. Thus, an observation with value 200 would fall into the 0-200 bin instead of the 200-400 bin.] These binned counts are plotted as bars in Figure @fig-clutch-volume-histogram.



```{r}
#| label: fig-clutch-volume-histogram
#| fig-cap: |
#|   A histogram of the clutch volumes in the `frog` data.  The histogram shows the
#|   few large clutch volumes discussed earlier
#| fig-alt: |
#|   A histogram of interest rate (ranging from close to 0 to more than 2500 cubic 
#|   milometers).
#| fig-asp: 0.4

ggplot(frog, aes(x = clutch.volume)) +
  geom_histogram(breaks = seq(0, 2800, 200)) +
  labs(x = "Clutch volume", y = "Count") +
  scale_x_continuous(
    breaks = seq(0, 2800, 500)
  )

```



```{r}
#| label: fig-singleBiMultiModalPlots
#| fig-cap: |
#|   Counting only prominent peaks, the distributions are (left to right)
#|   unimodal, bimodal, and multimodal. The left plot is unimodal
#|   because only prominent peaks are counted.
#| fig-alt: |
#|   Three separate histograms on simulated data. The first histogram
#|   shows a unimodal distribution, the second a bimodal
#|   distribution, and a multimodal distribution.
#| fig-asp: 0.3
#| out-width: 95%
set.seed(080546)
df_modes <- tibble(
  uni   = rchisq(65, 6),
  bi    = c(rchisq(22, 5.8), rnorm(43, 16.5, 2)),
  multi = c(rchisq(20, 3), rnorm(30, 15, 1), rnorm(15, 25, 1.5))
)

p_uni <- ggplot(df_modes, aes(x = uni)) +
  geom_histogram(binwidth = 2) +
  labs(x = NULL, y = NULL) +
  ylim(0, 23) +
  xlim(0, 30)
p_bi <- ggplot(df_modes, aes(x = bi)) +
  geom_histogram(binwidth = 2) +
  labs(x = NULL, y = NULL) +
  ylim(0, 23) +
  xlim(0, 30)
p_multi <- ggplot(df_modes, aes(x = multi)) +
  geom_histogram(binwidth = 2) +
  labs(x = NULL, y = NULL) +
  ylim(0, 23) +
  xlim(0, 30)

p_uni + p_bi + p_multi
```




## Relationships in data {#sec-relationships-in-data}

<!-- reorganize so scatterplot comes first, pick different country-->

Table @tbl-leapStudyResults shows a \index{relationship} **relationship** between the study intervention and outcome. The two intervention groups had different outcomes when exposed to peanut products at 5 years of age. The risk of a peanut allergy was more than 7 times greater for participants in the avoidance group relative to the consumption group.

When designing LEAP the study team hypothesized that the approaches to exposure to peanut products would lead to different outcomes. The outcome from the OFC was the \index{response variable} **response variable** in the study, and the intervention was a potential \index{explanatory variable} **explanatory variable**.

Much of this text explores methods for studying relationships in data, examining numerical and graphical methods to display relationships. Studying relationships in data is a major goal of statistics, and, indeed, of research in general. Section @sec-relationships-in-data illustrates numerical and graphical methods for relatively simple relationships between two variables. Chapters @sec-simple-linear-regression, @sec-multiple-linear-regression and @sec-logistic-regression discuss statistical models to help understand the relationships among two or more variables.

Even relationships between just two variables can take many forms. [The World Bank Data Group](https://data.worldbank.org/) provides free and open access to indicators of economic and social development in countries around the world. The data `wdi_2022` in the [openintro](http://openintrostat.github.io/openintro) R package contains data for some of those indicators for the year 2022. Figure @fig-wdi_2022-income-infant-mortality shows a \index{scatterplot} **scatterplot**

```{r}
#| label: fig-wdi_2022-income-infant-mortality
#| fig-cap: A scatterplot of infant mortality rate (on the y-axis) versus the 
#|    per-capita income for 217 countries as of 2022.  Infant mortality rate
#|    is measured as infant deaths before 1 year of age among 1,000 live births.
#| fig-alt: slightly modified text here

ggplot(wdi_2022, aes(x = gni_percap, y = infant_mortality_rate)) +
  geom_point(alpha = 0.3, fill = IMSCOL["black", "full"], shape = 21) +
  labs(
    x = "Income per capita",
    y = "Infant mortality rate"
  ) +
  geom_point(
    data = wdi_2022 |> 
    dplyr::filter(country == "Argentina"),
    size = 3, stroke = 2, color = IMSCOL["red", "full"], shape = 1
  ) +
  geom_text(
    data = wdi_2022 |> 
    dplyr::filter(country == "Argentina"),
    label = "Argentina", fontface = "italic",
    nudge_x = 21, nudge_y = -5, color = IMSCOL["red", "full"]
  ) +
  guides(color = FALSE) +
  geom_segment(
    data = wdi_2022 |> 
    dplyr::filter(country == "Argentina"),
    aes(
      x = 0, y = infant_mortality_rate, xend = gni_percap, 
      yend = infant_mortality_rate,
      color = IMSCOL["red", "full"]
    ), linetype = "dashed"
  ) +
  geom_segment(
    data = wdi_2022 |> 
    dplyr::filter(country == "Argentina"),
    aes(
      x = gni_percap, y = 0, xend = gni_percap, yend = infant_mortality_rate,
      color = IMSCOL["red", "full"]
    ), linetype = "dashed"
  ) +
  scale_x_continuous(labels = waiver()) +
  scale_y_continuous(labels = waiver())
```

## Case study: developmental disability support {#sec-developmenta-disability}
